/*!
betajs - v1.0.213 - 2020-08-10
Copyright (c) Oliver Friedmann,Victor Lingenthal
Apache-2.0 Software License.
*/

(function(){var d=this.subScope();d.binding("module","global:BetaJS"),d.define("module:",function(){return{guid:"71366f7a-7da3-4e55-9a0b-ea0e4e2a9e79",version:"1.0.213",datetime:1597033255788}}),d.require(["module:"],function(t){this.exports("undefined"!=typeof module?module:null,t)},this),d.define("module:Ajax.Support",["module:Ajax.NoCandidateAjaxException","module:Ajax.ReturnDataParseException","module:Ajax.RequestException","module:Ajax.TimeoutException","module:Promise","module:Objs","module:Types","module:Net.Uri","module:Net.HttpHeader","module:Async","module:Time"],function(t,s,a,e,c,n,i,r,o,_,u){return{__registry:[],register:function(t,e){this.__registry.push({descriptor:t,priority:e})},unwrapStatus:function(t,e){var n=t.status||o.HTTP_STATUS_INTERNAL_SERVER_ERROR;if(o.isSuccessStatus(n))return t.responseText;var i=t.statusText||o.format(n),r=t.responseText;try{r=this.parseReturnData(t.responseText,e)}catch(s){}throw new a(n,i,r)},parseReturnData:function(t,e){return"json"===e&&i.is_string(t)?JSON.parse(t):t},promiseReturnData:function(t,e,n,i){if(e.wrapStatus){try{n=this.parseReturnData(n,"json")}catch(r){return void t.asyncError(new s(n,i))}try{n=this.unwrapStatus(n,i)}catch(r){return void t.asyncError(r)}}try{t.asyncSuccess(this.parseReturnData(n,i))}catch(r){t.asyncError(new s(n,i))}},promiseRequestException:function(t,e,n,i,r){n=n||o.format(e);try{t.asyncError(new a(e,n,this.parseReturnData(i,r)))}catch(s){t.asyncError(new a(e,n,i))}},promiseTimeoutException:function(t){t.asyncError(new e(status,status_text,data))},preprocess:function(t){return(t=n.extend({method:"GET",mapMethodsKey:"_method",wrapStatus:!1,wrapStatusParam:null,context:this,query:{},jsonp:undefined,noCache:undefined,noCacheParam:null,signingFunction:null,signUrl:!1,postmessage:undefined,contentType:"urlencoded",resilience:1,resilience_filter:null,resilience_delay:1e3,cors:!1,sendContentType:!0,corscreds:!1,forceJsonp:!1,forcePostmessage:!1},t)).params&&(t.query=n.extend(t.query,t.params),delete t.params),i.is_empty(t.query)||(t.query=n.filter(t.query,function(t){return null!==t&&t!==undefined})),t.method=t.method.toUpperCase(),t.methodSupportsPayload="POST"===t.method||"PATCH"===t.method||"PUT"===t.method,t.baseUri&&(t.uri=t.uri?t.baseUri+t.uri:t.baseUri),delete t.baseUri,t.mapMethods&&t.method in t.mapMethods&&(t.uri=r.appendUriParams(t.uri,n.objectBy(t.mapMethodsKey,t.method)),t.method=t.mapMethods[t.method]),t.wrapStatus&&t.wrapStatusParam&&(t.uri=r.appendUriParams(t.uri,n.objectBy(t.wrapStatusParam,"true"))),t.noCache&&t.noCacheParam&&(t.uri=r.appendUriParams(t.uri,n.objectBy(t.noCacheParam,u.now()))),delete t.mapMethods,delete t.mapMethodsKey,"urlencoded"!==t.contentType||i.is_empty(t.data)||(t.data=n.filter(t.data,function(t){return null!==t&&t!==undefined})),t.isCorsRequest="undefined"!=typeof document&&r.isCrossDomainUri(document.location.href,t.uri),t},finalizeUri:function(t,e){return t.signUrl&&t.signingFunction?t.signingFunction(t,e):e},execute:function(i,r,s){i=this.preprocess(i);var o=null;if(this.__registry.forEach(function(t){(!o||o.priority<t.priority)&&t.descriptor.supports.call(t.descriptor.context||t.descriptor,i)&&(o=t)},this),!o)return c.error(new t(i));var u=function(e){var t=o.descriptor.execute.call(o.descriptor.context||o.descriptor,i,r,s);if(!e||e<=1)return t;var n=c.create();return t.forwardSuccess(n).error(function(t){a.is_class_instance(t)&&i.resilience_filter&&i.resilience_filter(t)?n.error(t):_.eventually(function(){u(e-1).forwardCallback(n)},i.resilience_delay)}),n};return u(i.resilience)}}}),d.define("module:Ajax.AbstractAjaxWrapper",["module:Class","module:Objs"],function(t,i,e){return t.extend({scoped:e},function(e){return{constructor:function(t){e.constructor.call(this),this.options=t},execute:function(t,e,n){return this._execute(i.extend(i.clone(this.options,1),t),e,n)},_execute:function(t,e,n){throw"Not implemented"}}})}),d.define("module:Ajax.HookedAjaxWrapper",["module:Ajax.AbstractAjaxWrapper","module:Promise"],function(t,i,e){return t.extend({scoped:e},function(r){return{constructor:function(t,e,n,i){r.constructor.call(this,i),this.ajaxWrapper=t,this.hookCallback=e,this.hookCallbackCtx=n,this.online=!0},_execute:function(t,e,n){return this.online?this.ajaxWrapper.execute(this.hookCallback.call(this.hookCallbackCtx||this,t),e,n):i.error("offline")}}})}),d.define("module:Ajax.AjaxWrapper",["module:Ajax.AbstractAjaxWrapper","module:Ajax.Support"],function(t,i,e){return t.extend({scoped:e},{_execute:function(t,e,n){return i.execute(t,e,n)}})}),d.define("module:Ajax.AjaxException",["module:Exceptions.Exception"],function(t,e){return t.extend({scoped:e},function(t){return{status_code:function(){return 500}}})}),d.define("module:Ajax.NoCandidateAjaxException",["module:Ajax.AjaxException"],function(t,e){return t.extend({scoped:e},function(t){return{}})}),d.define("module:Ajax.TimeoutException",["module:Ajax.AjaxException"],function(t,e){return t.extend({scoped:e},function(t){return{}})}),d.define("module:Ajax.ReturnDataParseException",["module:Ajax.AjaxException"],function(t,e){return t.extend({scoped:e},function(n){return{constructor:function(t,e){n.constructor.call(this,"Could not decode data with type "+e),this.__decodeType=e,this.__data=t}}})}),d.define("module:Ajax.RequestException",["module:Ajax.AjaxException","module:Objs"],function(t,e,n){return t.extend({scoped:n},function(i){return{constructor:function(t,e,n){i.constructor.call(this,t+": "+e),this.__status_code=t,this.__status_text=e,this.__data=n},status_code:function(){return this.__status_code},status_text:function(){return this.__status_text},data:function(){return this.__data},json:function(){return e.extend({data:this.data(),status_code:this.status_code(),status_text:this.status_text()},i.json.call(this))}}})}),d.define("module:Class",["module:Types","module:Objs","module:Functions","module:Ids"],function(h,l,i,n){var e=function(){};return e.extend=function(t,e,n,i){e=e||[],h.is_array(e)||(e=[e]),n=n||[],h.is_array(n)||(n=[n]),i=i||[],h.is_array(i)||(i=[i]);var r,s=this;e=l.map(e,function(t){return h.is_function(t)&&(t=t(s.prototype)),t}),l.iter(e,function(t){t.hasOwnProperty("constructor")&&(r=t.constructor)});var o=h.is_defined(r);o||(r=function(){s.prototype.constructor.apply(this,arguments)}),l.extend(r,s),l.iter(n,function(t){t=h.is_function(t)?t(s):t;var e=r._extender;l.extend(r,t),t._extender&&(r._extender=l.extend(l.clone(e,1),t._extender))});var u={};if(s.__class_statics_keys)for(var a in s.__class_statics_keys)r[a]=l.clone(s[a],1);l.iter(i,function(t){l.extend(r,t),l.extend(u,l.keys(t,!0))}),s.__class_statics_keys&&l.extend(u,s.__class_statics_keys),r.__class_statics_keys=u,r.parent=s,r.children=[],r.extend=this.extend,s.children||(s.children=[]),s.children.push(r);var c=function(){};c.prototype=s.prototype,r.prototype=new c,r.prototype.cls=r;var _=(t=l.extend({},h.is_string(t)?{classname:t,register:!0}:t)).classname;return t.scoped&&(_=t.scoped.ns.path),(r.classname=_)&&t.register&&d.setGlobal(_,r),r.__notifications={},r.__implements={},s.__notifications&&l.extend(r.__notifications,s.__notifications,1),s.__implements&&l.extend(r.__implements,s.__implements,1),l.iter(e,function(t){for(var e in t)r.prototype[e]=r._extender&&e in r._extender?r._extender[e](r.prototype[e],t[e]):t[e];if("constructor"in t&&(r.prototype.constructor=t.constructor),t._notifications)for(var n in t._notifications)r.__notifications[n]||(r.__notifications[n]=[]),r.__notifications[n].push(t._notifications[n]);t._implements&&l.iter(h.is_string(t._implements)?[t._implements]:t._implements,function(t){r.__implements[t]=!0})}),delete r.prototype._notifications,delete r.prototype._implements,o||(r.prototype.constructor=function(){s.prototype.constructor.apply(this,arguments)}),r},l.extend(e,{classname:"Class",__class_guid:"0f5499f9-f0d1-4c6c-a561-ef026a1eee05",__notifications:{},ancestor_of:function(t){return this==t||this!=e&&this.parent.ancestor_of(t)},is_class:function(t){return t&&h.is_object(t)&&"__class_guid"in t&&t.__class_guid==this.__class_guid},is_class_instance:function(t){return t&&h.is_object(t)&&"__class_instance_guid"in t&&t.__class_instance_guid==this.prototype.__class_instance_guid},is_pure_json:function(t){return t&&h.is_object(t)&&!this.is_class_instance(t)&&h.is_pure_object(t)},is_instance_of:function(t){return t&&this.is_class_instance(t)&&t.instance_of(this)},define:function(e,t){var n=i.getArguments(arguments,2);return h.is_object(e)?d.define(t,[],function(t){return n.unshift({scoped:t}),e.extend.apply(e,n)}):d.define(t,[e],function(t,e){return n.unshift({scoped:e}),t.extend.apply(t,n)})},abstractFunction:function(){throw"AbstractFunction"},_inherited:function(t,e){return t.parent[e].apply(this,Array.prototype.slice.apply(arguments,[2]))}}),e.prototype.__class_instance_guid="e6b0ed30-80ee-4b28-af02-7d52430ba45f",e.prototype.constructor=function(){this._notify("construct")},e.prototype.destroy=function(){this._notify("destroy"),this.__auto_destroy_list&&this.__auto_destroy_list.forEach(function(t){"destroy"in t&&t.weakDestroy()},this),this.__auto_decrease_ref_list&&this.__auto_decrease_ref_list.forEach(function(t){"decreaseRef"in t&&t.decreaseRef(this)},this);var t=this.cid();for(var e in this)delete this[e];n.objectId(this,t),this.destroy=this.__destroyedDestroy},e.prototype.destroyed=function(){return this.destroy===this.__destroyedDestroy},e.prototype.weakDestroy=function(){if(!this.destroyed()){if(this.__gc)return void this.__gc.queue(this);this.destroy()}},e.prototype.__destroyedDestroy=function(){throw"Trying to destroy destroyed object "+this.cid()+": "+this.cls.classname+"."},e.prototype.recursionProtection=function(t,e){if(this.__recursionProtection=this.__recursionProtection||{},this.__recursionProtection[t])return undefined;this.__recursionProtection[t]=!0;try{var n=e.apply(this);return this&&this.__recursionProtection&&delete this.__recursionProtection[t],n}catch(i){throw this&&this.__recursionProtection&&delete this.__recursionProtection[t],i}},e.prototype.enableGc=function(t){return this.supportsGc&&(this.__gc=t),this},e.prototype.dependDestroy=function(t){if(!t.destroyed())return this.__gc&&t.enableGc(),t.weakDestroy(),this},e.prototype.cid=function(){return n.objectId(this)},(e.prototype.cls=e).prototype.as_method=function(t){return i.as_method(this[t],this)},e.prototype.auto_destroy=function(t,e){if(t){this.__auto_destroy_list||(this.__auto_destroy_list=[]);var n=t;h.is_array(n)||(n=[n]);for(var i=0;i<n.length;++i)this.__auto_destroy_list.push(n[i])}return e?this:t},e.prototype.auto_decrease_ref=function(t,e){if(t){this.__auto_decrease_ref_list||(this.__auto_decrease_ref_list=[]);var n=t;h.is_array(n)||(n=[n]);for(var i=0;i<n.length;++i)this.__auto_decrease_ref_list.push(n[i])}return e?this:t},e.prototype._notify=function(n){var i;this.cls.__notifications&&(i=Array.prototype.slice.call(arguments,1),l.iter(this.cls.__notifications[n],function(t){var e=h.is_function(t)?t:this[t];if(!e)throw this.cls.classname+": Could not find "+n+" notification handler "+t;e.apply(this,i)},this))},e.prototype.impl=function(t){return!(!this.cls.__implements||!this.cls.__implements[h.is_string(t)?t:t._implements])},e.prototype.instance_of=function(t){return this.cls.ancestor_of(t)},e.prototype.increaseRef=function(t,e){return this.__referenceCount=this.__referenceCount||0,this.__referenceCount++,this.__referenceObjects=this.__referenceObjects||{},t&&(this.__referenceObjects[t.cid()]?this.__referenceCount--:this.__referenceObjects[t.cid()]=t,e&&t.auto_decrease_ref(this)),this},e.prototype.decreaseRef=function(t){return this.__referenceCount=this.__referenceCount||0,this.__referenceCount--,this.__referenceObjects=this.__referenceObjects||{},t&&(this.__referenceObjects[t.cid()]?delete this.__referenceObjects[t.cid()]:this.__referenceCount++),this.__referenceCount<=0&&h.is_empty(this.__referenceObjects)&&this.weakDestroy(),this},e.prototype.inspect=function(){return{header:{cid:this.cid(),classname:this.cls.classname,destroyed:this.destroyed()},attributes:{attributes_public:l.filter(this,function(t,e){return!h.is_function(t)&&0!==e.indexOf("_")},this),attributes_protected:l.filter(this,function(t,e){return!h.is_function(t)&&0===e.indexOf("_")&&0!==e.indexOf("__")},this),attributes_private:l.filter(this,function(t,e){return!h.is_function(t)&&0===e.indexOf("__")},this)},methods:{methods_public:l.filter(this,function(t,e){return h.is_function(t)&&0!==e.indexOf("_")},this),methods_protected:l.filter(this,function(t,e){return h.is_function(t)&&0===e.indexOf("_")&&0!==e.indexOf("__")},this),method_private:l.filter(this,function(t,e){return h.is_function(t)&&0===e.indexOf("__")},this)}}},e.prototype._auto_destroy=function(t){return this.auto_destroy(t)},e.prototype._inherited=function(t,e){return t.parent.prototype[e].apply(this,Array.prototype.slice.apply(arguments,[2]))},e}),d.define("module:Classes.InvokerMixin",["module:Objs","module:Types","module:Functions"],function(e,r,s){return{invoke_delegate:function(n,t){r.is_array(t)||(t=[t]),n=this[n];var i=this;e.iter(t,function(t){this[t]=function(e){return function(){var t=s.getArguments(arguments);return t.unshift(e),n.apply(i,t)}}.call(i,t)},this)}}}),d.define("module:Classes.HelperClassMixin",["module:Objs","module:Types","module:Functions","module:Promise"],function(s,o,u,a){return{addHelper:function(t,e){var n=new t(this,e);return this.__helpers=this.__helpers||[],this.__helpers.push(this._auto_destroy(n)),n},_helper:function(t){this.__helpers=this.__helpers||[],o.is_string(t)&&(t={method:t}),t=s.extend({fold_start:null,fold:function(t,e){return t||e}},t);for(var e=u.getArguments(arguments,1),n=t.async?a.create(t.fold_start):t.fold_start,i=0;i<this.__helpers.length;++i){var r=this.__helpers[i];t.method in r&&(n=t.async?a.func(t.fold,n,a.methodArgs(r,r[t.method],e)):t.fold(n,r[t.method].apply(r,e)))}return n}}}),d.define("module:Classes.PathResolver",["module:Class","module:Objs"],function(t,o,e){return t.extend({scoped:e},function(e){return{constructor:function(t){e.constructor.call(this),this._bindings=t||{}},extend:function(t,e){if(e)for(var n in t){for(var i=t[n],r=/\{([^}]+)\}/;;){var s=r.exec(i);if(!s)break;i=i.replace(r,e+"."+s[1])}this._bindings[e+"."+n]=i}else this._bindings=o.extend(this._bindings,t)},map:function(t){for(var e=[],n=0;n<t.length;++n)t[n]&&e.push(this.resolve(t[n]));return e},resolve:function(t){for(var e=/\{([^}]+)\}/;;){var n=e.exec(t);if(!n)break;t=t.replace(e,this._bindings[n[1]])}return this.simplify(t)},simplify:function(t){return t.replace(/[^\/]+\/\.\.\//,"").replace(/\/[^\/]+\/\.\./,"")}}})}),d.define("module:Classes.MultiDelegatable",["module:Class","module:Objs"],function(t,i,e){return t.extend({scoped:e},function(n){return{constructor:function(t,e){n.constructor.call(this),i.iter(e,function(n){this[n]=function(){var e=arguments;return i.iter(t,function(t){t[n].apply(t,e)},this),this}},this)}}})}),d.define("module:Classes.ObjectIdScopeMixin",function(){return{__objects:{},get:function(t){return this.__objects[t]}}}),d.define("module:Classes.ObjectIdScope",["module:Class","module:Classes.ObjectIdScopeMixin"],function(t,e,n){return t.extend({scoped:n},e,function(t){return{singleton:function(){return this.__singleton||(this.__singleton=new this),this.__singleton}}})}),d.define("module:Classes.SingletonMixin",[],function(){return{_notifications:{construct:"__singleton_create",destroy:"__singleton_destroy"},__singleton_create:function(){if(this.cls.__singleton)throw"Can only create a single instance of "+this.cls.classname;this.cls.__singleton=this},__singleton_destroy:function(){this.cls.__singleton=null}}}),d.define("module:Classes.SingletonClassMixin",[],function(){return{singleton:function(){return this.__singleton=this.__singleton||new this,this.__singleton}}}),d.define("module:Classes.ObjectIdMixin",["module:Classes.ObjectIdScope"],function(t){return{_notifications:{construct:"__register_object_id",destroy:"__unregister_object_id"},__object_id_scope:function(){return this.object_id_scope||(this.object_id_scope=t.singleton()),this.object_id_scope},__register_object_id:function(){this.__object_id_scope().__objects[this.cid()]=this},__unregister_object_id:function(){delete this.__object_id_scope().__objects[this.cid()]}}}),d.define("module:Classes.SharedObjectFactory",["module:Class"],function(t,e){return t.extend({scoped:e},function(i){return{constructor:function(t,e,n){i.constructor.call(this),this.__createCallback=t,this.__createContext=e,this.__createArgs=n||[],this.__object=null},destroy:function(){this.__object&&!this.__object.destroyed()&&this.__object.destroy(),i.destroy.call(this)},value:function(){return this.__object&&!this.__object.destroyed()?this.__object:null},isAcquired:function(){return!!this.value()},acquire:function(t,e){return this.__object&&!this.__object.destroyed()||(this.__object=this.__createCallback.apply(this.__createContext||this,this.__createArgs)),this.__object.increaseRef(t,e),this.__object},release:function(t,e){t&&t===this.__object&&!t.destroyed()&&t.decreaseRef(t)}}})}),d.define("module:Classes.SharedObjectFactoryPool",["module:Class","module:Objs","module:Functions"],function(t,e,i,n){return t.extend({scoped:n},function(n){return{constructor:function(t,e){n.constructor.call(this),this.__createCallback=t,this.__createContext=e,this.__cache={}},destroy:function(){e.iter(this.__cache,function(t){t.weakDestroy()},this),n.destroy.call(this)},acquire:function(){var t=i.getArguments(arguments),e=JSON.stringify(t);return this.__cache[e]&&!this.__cache[e].destroyed()||(this.__cache[e]=this.__createCallback.apply(this.__createContext||this,t)),this.__cache[e]}}})}),d.define("module:Classes.CriticalSectionMixin",["module:Promise"],function(i){return{criticalSection:function(t,e){this.__criticalSections=this.__criticalSections||{},this.__criticalSections[t]=this.__criticalSections[t]||[];var n=i.create();return this.__criticalSections[t].push(n),1===this.__criticalSections[t].length&&n.asyncSuccess(!0),n.mapSuccess(function(){return i.box(e,this).callback(function(){this.__criticalSections[t].shift(),0<this.__criticalSections[t].length&&this.__criticalSections[t][0].asyncSuccess(!0)},this)},this)}}}),d.define("module:Classes.CacheHash",["module:Class"],function(t,e){return t.extend({scoped:e},function(e){return{constructor:function(t){e.constructor.call(this),this.__prefix=t||"",this.__counter=0,this.__cache={},this.__hash={}},hashKey:function(t){if(t in this.__hash)return this.__hash[t];var e=this.__prefix+this.__counter++;return this.__hash[t]=e,this.__cache[e]=t,e},hash:function(){return this.__hash},cache:function(){return this.__cache}}})}),d.define("module:Comparators",["module:Types","module:Properties.Properties"],function(s,o){return{byObject:function(r){var s=this;return function(t,e){for(var n in r){var i=0;if(0!==(i=o.is_class_instance(t)&&o.is_class_instance(e)?s.byValue(t.get(n)||null,e.get(n)||null):s.byValue(t[n]||null,e[n]||null)))return i*r[n]}return 0}},byValue:function(t,e){return s.is_string(t)?t.localeCompare(e):t<e?-1:e<t?1:0},deepEqual:function(t,e,n){if(0===n)return!0;if(1===n)return t===e;if(s.is_array(t)&&s.is_array(e)){if(t.length!==e.length)return!1;for(var i=0;i<t.length;++i)if(!this.deepEqual(t[i],e[i],n-1))return!1;return!0}if(s.is_object(t)&&s.is_object(e)){if(!t||!e)return t===e;for(var r in t)if(!this.deepEqual(t[r],e[r],n-1))return!1;for(r in e)if(!(r in t))return!1;return!0}return t===e},listEqual:function(t,e){return this.deepEqual(t,e,2)}}}),d.define("module:Compress",function(){return{lzw_like_encode:function(t,e){e===undefined&&(e=256);for(var n=new Map,i=[],r=0;r<e;++r)n.set(String.fromCharCode(r),r);for(var s="",o=0;o<t.length;++o){var u=t.charAt(o);if(n.has(u)){if(n.has(s+u))s+=u;else if(i.push(n.get(s)),n.set(s+u,n.size),s=u,65535<=n.size){for(n=new Map,r=0;r<e;++r)n.set(String.fromCharCode(r),r);s="",o--}}else s&&i.push(n.get(s)),n.set(u,n.size),i.push(n.size+1),i.push(t.charCodeAt(o)),s=""}return s&&i.push(n.get(s)),i.map(function(t){return String.fromCharCode(t)}).join("")},lzw_like_decode:function(t,e){e===undefined&&(e=256);for(var n=[],i=[],r=0;r<e;++r)n.push(String.fromCharCode(r));for(var s="",o=0;o<t.length;++o){var u=t.charCodeAt(o);if(u>n.length)o++,u=t.charCodeAt(o),i.push(String.fromCharCode(u)),n.push(String.fromCharCode(u)),s="";else{var a=u<n.length?n[u]:s+s.charAt(0);if(i.push(a),s&&n.push(s+a.charAt(0)),s=a,65534<=n.length){for(n=[],r=0;r<e;++r)n.push(String.fromCharCode(r));s=""}}}return i.join("")}}}),d.define("module:Events.EventsMixin",["module:Timers.Timer","module:Async","module:Lists.LinkedList","module:Functions","module:Types","module:Objs"],function(r,n,a,o,e,s){return{_implements:"3d63b44f-c9f0-4aa7-b39e-7cbf195122b4",_notifications:{construct:function(){this.__suspendedEvents=0,this.__suspendedEventsQueue=[]},destroy:function(){this.off(null,null,null)}},EVENT_SPLITTER:/\s+/,__create_event_object:function(t,e,n){var i={callback:t,context:e};return(n=n||{}).eventually&&(i.eventually=n.eventually),n.off_on_destroyed&&(i.off_on_destroyed=n.off_on_destroyed),n.min_delay&&(i.min_delay=new r({delay:n.min_delay,once:!0,start:!1,context:this,fire:function(){i.max_delay&&i.max_delay.stop(),this.__invokeCallback(i)}})),n.max_delay&&(i.max_delay=new r({delay:n.max_delay,once:!0,start:!1,context:this,fire:function(){i.min_delay&&i.min_delay.stop(),this.__invokeCallback(i)}})),n.norecursion&&(i.no_recursion=!0),i},__destroy_event_object:function(t){t.min_delay&&t.min_delay.destroy(),t.max_delay&&t.max_delay.destroy()},__invokeCallback:function(t,e){if(t.off_on_destroyed&&t.context&&t.context.destroyed())this.off(null,null,t);else if(!t.no_recursion||!t.in_recursion){t.in_recursion=!0;try{this._invokeCallback(t.callback,t.context||this,e||t.params)}finally{t.in_recursion=!1}}},_invokeCallback:function(t,e,n){t.apply(e,n)},__call_event_object:function(t,e){t.min_delay&&t.min_delay.restart(),t.max_delay&&t.max_delay.start(),t.min_delay||t.max_delay?t.params=e:t.eventually?n.eventually(function(){this.__invokeCallback(t,e)},this,!0===t.eventually?0:t.eventually):this.__invokeCallback(t,e)},on:function(t,e,n,i){var r;for(this.__events_mixin_events=this.__events_mixin_events||{},t=t.split(this.EVENT_SPLITTER);r=t.shift();){this.__events_mixin_events[r]||this._notify("register_event",r),this.__events_mixin_events[r]=this.__events_mixin_events[r]||new a;var s=this.__create_event_object(e,n,i);if(this.__events_mixin_events[r].add(s),this.__events_mixin_persistent_events&&this.__events_mixin_persistent_events[r])for(var o=this.__events_mixin_persistent_events[r],u=0;u<o.length;++u)this.__call_event_object(s,o[u]);i&&i.initcall&&this.__call_event_object(s,[])}return this},off:function(t,n,i){return this.__events_mixin_events=this.__events_mixin_events||{},t?(t=t.split(this.EVENT_SPLITTER),s.iter(t,function(t){this.__events_mixin_events[t]&&(this.__events_mixin_events[t].remove_by_filter(function(t){var e=!(n&&t.callback!=n||i&&t.context!=i);return e&&this.__destroy_event_object&&this.__destroy_event_object(t),e}),0===this.__events_mixin_events[t].count()&&(this.__events_mixin_events[t].destroy(),delete this.__events_mixin_events[t],this._notify("unregister_event",t)))},this)):s.iter(this.__events_mixin_events,function(t,e){t.remove_by_filter(function(t){var e=!(n&&t.callback!=n||i&&t.context!=i);return e&&this.__destroy_event_object&&this.__destroy_event_object(t),e}),0===t.count()&&(t.destroy(),delete this.__events_mixin_events[e],this._notify("unregister_event",e))},this),this},once:function(t,e,n,i){var r=this,s=o.once(function(){r.off(t,s),e.apply(this,arguments)});return s._callback=e,this.on(t,s,n,i)},trigger:function(t){if(0<this.__suspendedEvents)return this.__suspendedEventsQueue.push(arguments),this;var n=this;t=t.split(this.EVENT_SPLITTER);var i=o.getArguments(arguments,1);return this.__events_mixin_events&&s.iter(t,function(e){this.__events_mixin_events[e]&&this.__events_mixin_events[e].iterate(function(t){n.__call_event_object(t,i)}),this.__events_mixin_events&&"all"in this.__events_mixin_events&&this.__events_mixin_events.all.iterate(function(t){n.__call_event_object(t,[e].concat(i))})},this),this},triggerAsync:function(){var t=this,e=o.getArguments(arguments),n=setTimeout(function(){clearTimeout(n),t.trigger.apply(t,e)},0);return this},persistentTrigger:function(t){var e=o.getArguments(arguments,1);return this.__events_mixin_persistent_events=this.__events_mixin_persistent_events||[],s.iter(t.split(this.EVENT_SPLITTER),function(t){this.__events_mixin_persistent_events[t]=this.__events_mixin_persistent_events[t]||[],this.__events_mixin_persistent_events[t].push(e)},this),this.trigger.apply(this,arguments),this},delegateEvents:function(t,n,i,r){return r=r||[],i=i?i+":":"",null===t?n.on("all",function(t){var e=o.getArguments(arguments,1);this.trigger.apply(this,[i+t].concat(r).concat(e))},this):(e.is_array(t)||(t=[t]),s.iter(t,function(e){n.on(e,function(){var t=o.getArguments(arguments);this.trigger.apply(this,[i+e].concat(r).concat(t))},this)},this)),this},_eventChain:function(){},chainedTrigger:function(t,e){var n;return e=s.extend({source:this,bubbles:!0},e),this.trigger(t,e),!e.bubbles||(n=this._eventChain())&&n.chainedTrigger&&n.chainedTrigger(t,e),this},suspendEvents:function(){return this.__suspendedEvents++,this},resumeEvents:function(){return this.__suspendedEvents--,0!==this.__suspendedEvents||(s.iter(this.__suspendedEventsQueue,function(t){this.trigger.apply(this,t)},this),this.__suspendedEventsQueue=[]),this}}}),d.define("module:Events.Events",["module:Class","module:Events.EventsMixin"],function(t,e,n){return t.extend({scoped:n},e)}),d.define("module:Events.ListenMixin",["module:Ids","module:Objs","module:Types"],function(r,i,s){return{_notifications:{destroy:"listenOff"},listenOn:function(t,e,n,i){return this.__listen_mixin_listen||(this.__listen_mixin_listen={}),s.is_array(t)||(t=[t]),t.forEach(function(t){(this.__listen_mixin_listen[r.objectId(t)]=t).on(e,n,this,i)},this),this},listenOnce:function(t,e,n,i){return this.__listen_mixin_listen||(this.__listen_mixin_listen={}),s.is_array(t)||(t=[t]),t.forEach(function(t){(this.__listen_mixin_listen[r.objectId(t)]=t).once(e,n,this,i)},this),this},listenOff:function(t,e,n){return this.__listen_mixin_listen&&(s.is_array(t)||(t=[t]),t.forEach(function(t){t&&!t.destroyed()?(t.off(e,n,this),e||n||delete this.__listen_mixin_listen[r.objectId(t)]):i.iter(this.__listen_mixin_listen,function(t){t&&"off"in t&&!t.destroyed()&&t.off(e,n,this),e||n||delete this.__listen_mixin_listen[r.objectId(t)]},this)},this)),this}}}),d.define("module:Events.Listen",["module:Class","module:Events.ListenMixin"],function(t,e,n){return t.extend({scoped:n},e)}),d.define("module:Functions",["module:Types"],function(u){return{getStackTrace:function(t){for(var e=(new Error).stack.split("\n");0<e.length&&"error"===e[0].trim().toLowerCase();)e.shift();return t?e.slice(t):e},as_method:function(t,e){return function(){return t.apply(e,arguments)}},global_method:function(t){var e=d.getGlobal(t);return e?this.as_method(e,d.getGlobal()):e},once:function(t){var e=!1,n=!1;return function(){return n||(n=!0,e=t.apply(this,arguments),t=null),e}},getArguments:function(t,e){return Array.prototype.slice.call(t,e||0)},matchArgs:function(t,e,n){arguments.length<3&&(n=e,e=0);var i=e,r={};for(var s in n){var o=n[s];!0===o?o={required:!0}:"string"==typeof o&&(o={type:o}),o.required||o.type&&u.type_of(t[i])==o.type?(r[s]=t[i],i++):o.def&&(r[s]=u.is_function(o.def)?o.def(r):o.def)}return r},newClassFunc:function(n){return function(){var t=arguments;function e(){return n.apply(this,t)}return e.prototype=n.prototype,new e}},newClass:function(t){return this.newClassFunc(t).apply(this,this.getArguments(arguments,1))},callWithin:function(t,e){return u.is_string(e)&&(e=t[e]),e.apply(t,this.getArguments(arguments,2))}}}),d.define("module:Events.HooksMixin",["module:Promise","module:Functions"],function(i,r){var s=function(t,n){return 0<n.length?t.mapSuccess(function(t){var e=n.shift();return s(i.value(e(t)),n)}):t};return{_implements:"e07d77f0-d9d5-41dc-ae4d-20fb8af0a334",_notifications:{construct:function(){this.__methodHooks={}}},registerHook:function(t,e,n){this.__methodHooks[t]=this.__methodHooks[t]||[],this.__methodHooks[t].push(r.as_method(e,n||this))},invokeHook:function(t,e){return s(i.value(e),this.__methodHooks[t]||[])}}}),d.define("module:Ids",["module:Types","module:Objs"],function(n,i){return{__uniqueId:0,uniqueId:function(t){return(t||"")+this.__uniqueId++},objectId:function(t,e){return t?(e!==undefined?t.__cid=e:t.__cid||(t.__cid=this.uniqueId("cid_")),t.__cid):undefined},uniqueKey:function(t,e){return e&&0<e&&(n.is_object(t)||n.is_array(t))?JSON.stringify(i.map(t,function(t){return this.uniqueKey(t,e-1)},this)):null!==t&&n.is_object(t)||n.is_array(t)||n.is_function(t)?this.objectId(t):t}}}),d.define("module:IdGenerators.IdGenerator",["module:Class"],function(t,e){return t.extend({scoped:e},{generate:function(t){},valid:function(t,e){return!1}})}),d.define("module:IdGenerators.PrefixedIdGenerator",["module:IdGenerators.IdGenerator"],function(t,e){return t.extend({scoped:e},function(n){return{constructor:function(t,e){n.constructor.call(this),this.__prefix=t,this.__generator=e},generate:function(t){return this.__prefix+this.__generator.generate(t)},valid:function(t,e){return 0===t.indexOf(this.__prefix)&&this.__generator.valid(t.substring(this.__prefix.length),e)}}})}),d.define("module:IdGenerators.RandomIdGenerator",["module:IdGenerators.IdGenerator","module:Tokens"],function(t,n,e){return t.extend({scoped:e},function(e){return{constructor:function(t){e.constructor.call(this),this.__length=t||16},generate:function(t){return n.generate_token(this.__length)},valid:function(t,e){return t.length===this.__length}}})}),d.define("module:IdGenerators.ConsecutiveIdGenerator",["module:IdGenerators.IdGenerator"],function(t,e){return t.extend({scoped:e},function(e){return{constructor:function(t){e.constructor.call(this),this.__current=t||0},generate:function(t){return this.__current++,this.__current},valid:function(t,e){return!isNaN(t)}}})}),d.define("module:IdGenerators.TimedIdGenerator",["module:IdGenerators.IdGenerator","module:Time"],function(t,n,e){return t.extend({scoped:e},function(t){return{constructor:function(){t.constructor.call(this),this.__current=n.now()-1},generate:function(t){var e=n.now();return this.__current=e>this.__current?e:this.__current+1,this.__current},valid:function(t,e){return!isNaN(t)}}})}),d.define("module:JavaScript",["module:Objs"],function(i){return{STRING_SINGLE_QUOTATION_REGEX:/'[^']*'/g,STRING_DOUBLE_QUOTATION_REGEX:/"[^"]*"/g,PROPER_IDENTIFIER_REGEX:/^[a-zA-Z_][a-zA-Z_0-9]*$/,IDENTIFIER_REGEX:/[a-zA-Z_][a-zA-Z_0-9]*/g,IDENTIFIER_SCOPE_REGEX:/[a-zA-Z_][a-zA-Z_0-9\.]*/g,RESERVED:i.objectify(["if","then","else","return","var"],!0),isReserved:function(t){return t in this.RESERVED},isIdentifier:function(t){return!this.isReserved(t)},isProperIdentifier:function(t){return this.isIdentifier(t)&&this.PROPER_IDENTIFIER_REGEX.test(t)},removeStrings:function(t){return t.replace(this.STRING_SINGLE_QUOTATION_REGEX,"").replace(this.STRING_DOUBLE_QUOTATION_REGEX,"")},extractIdentifiers:function(t,e){var n=e?this.IDENTIFIER_SCOPE_REGEX:this.IDENTIFIER_REGEX;return t=this.removeStrings(t),i.filter(t.match(n),this.isIdentifier,this)},extractFunctionParameterNames:function(t){return t.toString().match(/function \((.*)\).*/)[1].replace(/\s*/g,"").split(",")}}}),d.define("module:KeyValue.KeyValueStore",["module:Class","module:Events.EventsMixin"],function(t,e,n){return t.extend({scoped:n},[e,function(t){return{mem:function(t){return this._mem(t)},get:function(t){return this._get(t)},set:function(t,e){this._set(t,e),this.trigger("change:"+t,e)},remove:function(t){this._remove(t)}}}])}),d.define("module:KeyValue.PrefixKeyValueStore",["module:KeyValue.KeyValueStore"],function(t,e){return t.extend({scoped:e},function(n){return{constructor:function(t,e){n.constructor.call(this),this.__kv=t,this.__prefix=e},_mem:function(t){return this.__kv.mem(this.__prefix+t)},_get:function(t){return this.__kv.get(this.__prefix+t)},_set:function(t,e){this.__kv.set(this.__prefix+t,e)},_remove:function(t){this.__kv.remove(this.__prefix+t)}}})}),d.define("module:KeyValue.MemoryKeyValueStore",["module:KeyValue.KeyValueStore","module:Objs"],function(t,i,e){return t.extend({scoped:e},function(n){return{constructor:function(t,e){n.constructor.call(this),this.__data=i.clone(t,e?1:0)},_mem:function(t){return t in this.__data},_get:function(t){return this.__data[t]},_set:function(t,e){this.__data[t]=e},_remove:function(t){delete this.__data[t]}}})}),d.define("module:KeyValue.DefaultKeyValueStore",["module:KeyValue.KeyValueStore"],function(t,e){return t.extend({scoped:e},function(n){return{constructor:function(t,e){n.constructor.call(this),this.__kv=t,this.__def=e},_mem:function(t){return this.__kv.mem(t)||this.__def.mem(t)},_get:function(t){return this.__kv.mem(t)?this.__kv.get(t):this.__def.get(t)},_set:function(t,e){this.__kv.set(t,e)},_remove:function(t){this.__kv.remove(t)}}})}),d.define("module:Lists.AbstractList",["module:Class","module:Objs","module:Types","module:Iterators.ArrayIterator"],function(t,n,r,i,e){return t.extend({scoped:e},function(e){return{_add:function(t){},_remove:function(t){},_get:function(t){},_iterate:function(t,e){},get_ident:function(n){var i=null;return this._iterate(function(t,e){return t!=n||(i=e,!1)}),i},exists:function(t){return t&&null!==this.get_ident(t)},_ident_changed:function(t,e){},constructor:function(t){e.constructor.call(this),this.__count=0,t&&n.iter(t,function(t){this.add(t)},this)},add:function(t){var e=this._add(t);return r.is_defined(e)&&this.__count++,e},count:function(){return this.__count},clear:function(){this._iterate(function(t,e){return this.remove_by_ident(e),!0},this)},remove_by_ident:function(t){var e=this._remove(t);return r.is_defined(e)&&this.__count--,e},remove:function(t){return this.remove_by_ident(this.get_ident(t))},remove_by_filter:function(n){this._iterate(function(t,e){return n(t)&&this.remove_by_ident(e),!0},this)},get:function(t){return this._get(t)},iterate:function(i,t){this._iterate(function(t,e){var n=i.call(this,t,e);return!r.is_defined(n)||n},t)},iterator:function(){return i.byIterate(this.iterate,this)}}})}),d.define("module:Lists.LinkedList",["module:Lists.AbstractList"],function(t,e){return t.extend({scoped:e},function(t){return{__first:null,__last:null,_add:function(t){return this.__last={obj:t,prev:this.__last,next:null},this.__first?this.__last.prev.next=this.__last:this.__first=this.__last,this.__last},_remove:function(t){return t.next?t.next.prev=t.prev:this.__last=t.prev,t.prev?t.prev.next=t.next:this.__first=t.next,t.obj},_get:function(t){return t.obj},_iterate:function(t,e){for(var n=this.__first;n;){var i=n,n=n.next;if(!t.apply(e||this,[i.obj,i]))return}}}})}),d.define("module:Lists.ObjectIdList",["module:Lists.AbstractList","module:Ids"],function(t,i,e){return t.extend({scoped:e},function(n){return{constructor:function(t,e){this.__map={},this.__id_generator=e,n.constructor.call(this,t)},_add:function(t){var e=t.__cid;if(!e)for(;e=this.__id_generator?i.objectId(t,this.__id_generator()):i.objectId(t),this.__map[e]&&this.__id_generator;);return this.__map[e]=t,e},_remove:function(t){var e=this.__map[t];return delete this.__map[t],e},_get:function(t){return this.__map[t]},_iterate:function(t,e){for(var n in this.__map)t.apply(e||this,[this.__map[n],n])},get_ident:function(t){var e=i.objectId(t);return this.__map[e]?e:null}}})}),d.define("module:Lists.ArrayList",["module:Lists.AbstractList","module:Ids","module:Objs"],function(t,e,r,n){return t.extend({scoped:n},function(n){return{constructor:function(t,e){this.__idToIndex={},this.__items=[],"compare"in(e=e||{})&&(this._compare=e.compare),"get_ident"in e&&(this._get_ident=e.get_ident),n.constructor.call(this,t)},set_compare:function(t){(this._compare=t)&&this.sort()},get_compare:function(){return this._compare},sort:function(t){if(t=t||this._compare){this.__items.sort(t);for(var e=0;e<this.__items.length;++e)this.__ident_changed(this.__items[e],e);this._sorted()}},_sorted:function(){},re_index:function(t){if(!this._compare)return t;for(var e=this.__items.length-1,n=this.__items[t],i=t;i<e&&0<this._compare(this.__items[i],this.__items[i+1]);)this.__items[i]=this.__items[i+1],this.__ident_changed(this.__items[i],i),this.__items[i+1]=n,++i;if(i==t)for(;0<i&&this._compare(this.__items[i],this.__items[i-1])<0;)this.__items[i]=this.__items[i-1],this.__ident_changed(this.__items[i],i),this.__items[i-1]=n,--i;return i!=t&&(this.__ident_changed(n,i),this._re_indexed(n)),i},_re_indexed:function(t){},__objectId:function(t){return this._get_ident?this._get_ident(t):e.objectId(t)},_add:function(t){var e=this.__items.length;this.__items.push(t);var n=this.re_index(e);return this.__idToIndex[this.__objectId(t)]=n},_remove:function(t){for(var e=this.__items[t],n=t+1;n<this.__items.length;++n)this.__items[n-1]=this.__items[n],this.__ident_changed(this.__items[n-1],n-1);return this.__items.pop(),delete this.__idToIndex[this.__objectId(e)],e},_get:function(t){return this.__items[t]},_iterate:function(t,e){for(var n=r.clone(this.__items,1),i=0;i<n.length;++i)t.apply(e||this,[n[i],this.get_ident(n[i])])},__ident_changed:function(t,e){this.__idToIndex[this.__objectId(t)]=e,this._ident_changed(t,e)},get_ident:function(t){var e=this.__objectId(t);return e in this.__idToIndex?this.__idToIndex[e]:null},ident_by_id:function(t){return this.__idToIndex[t]}}})}),d.define("module:Maths",[],function(){return{discreteCeil:function(t,e,n){var i=Math.ceil(t/e)*e;return n&&n<i?0:i}}}),d.define("module:Objs",["module:Types","module:Functions"],function(u,n){return{ithKey:function(t,e){for(var n in e=e||0,t){if(e<=0)return n;--e}return null},ithValue:function(t,e){for(var n in e=e||0,t){if(e<=0)return t[n];--e}return null},valueByIndex:function(t,e){return u.is_array(t)?t[e||0]:this.ithValue(t,e)},keyByIndex:function(t,e){return u.is_array(t)?e||0:this.ithKey(t,e)},count:function(t){if(u.is_array(t))return t.length;var e=0;for(var n in t)e++;return e},clone:function(t,e){return t&&e&&0!==e?u.is_array(t)?t.slice(0):u.is_object(t)?this.extend({},t,e-1):t:t},acyclic_clone:function(t){if(null===t||!u.is_object(t))return t;var e="__acyclic_cloned";if(t[e])return t[e];var n={};for(var i in t[e]=n,t)i!==e&&(n[i]=this.acyclic_clone(t[i]));return delete t[e],n},extend:function(t,e,n){if(t=t||{},e)for(var i in e)t[i]=this.clone(e[i],n);return t},multi_extend:function(){var t,e=n.getArguments(arguments);for(u.is_object(e[e.length-1])||(t=e[e.length-1],e.pop());1<e.length;)e[1]=this.extend(e[0],e[1],t),e.shift();return e[0]},weak_extend:function(t,e,n){if(t=t||{},e)for(var i in e)i in t||(t[i]=this.clone(e[i],n));return t},tree_extend:function(t,e,n){if(t=t||{},e)for(var i in e)i in t&&u.is_object(t[i])&&u.is_object(e[i])&&!u.is_array(t[i])&&!u.is_array(e[i])?t[i]=this.tree_extend(t[i],e[i],n):t[i]=this.clone(e[i],n);return t},keys:function(t,e){var n=null,i=null;if(u.is_undefined(e)){for(i in n=[],t)n.push(i);return n}for(i in n={},t)n[i]=e;return n},subset_of:function(t,e){for(var n in t=u.is_array(t)?this.objectify(t):t,e=u.is_array(e)?this.objectify(e):e,t)if(t[n]!=e[n])return!1;return!0},superset_of:function(t,e){return this.subset_of(e,t)},pairArrayToObject:function(t){for(var e={},n=0;n<t.length/2;n+=2)e[t[n]]=t[n+1];return e},pairsToObject:function(){for(var t={},e=0;e<arguments.length;++e)t[arguments[e][0]]=arguments[e][1];return t},inverseKeyValue:function(t){var n={};return this.iter(t,function(t,e){n[t]=e}),n},exists:function(t,e,n){var i=!1;return this.iter(t,function(){return!(i=i||e.apply(this,arguments))},n),i},all:function(t,e,n){var i=!0;return this.iter(t,function(){return i=i&&e.apply(this,arguments)},n),i},peek:function(t){if(u.is_array(t))return 0<t.length?t[0]:null;for(var e in t)return t[e];return null},poll:function(t){if(u.is_array(t))return t.shift();for(var e in t){var n=t[e];return delete t[e],n}return null},iter:function(t,e,n){var i=null;if(u.is_array(t)){for(var r=0;r<t.length;++r)if(i=n?e.apply(n,[t[r],r]):e(t[r],r),u.is_defined(i)&&!i)return!1}else for(var s in t)if(i=n?e.apply(n,[t[s],s]):e(t[s],s),u.is_defined(i)&&!i)return!1;return!0},intersect:function(t,e){var n={};for(var i in t)i in e&&(n[i]=t[i]);return n},keyEquals:function(t,e){for(var n in t)if(!(n in e))return!1;for(n in e)if(!(n in t))return!1;return!0},splitObject:function(t,n,e){var i={},r={};return this.iter(t,function(t,e){n.apply(this,arguments)?i[e]=t:r[e]=t},e),[i,r]},diff:function(t,e){var n={};for(var i in t)i in e&&t[i]===e[i]||(n[i]=t[i]);return n},contains_key:function(t,e){return u.is_array(t)?u.is_defined(t[e]):e in t},contains_value:function(t,e){if(u.is_array(t)){for(var n=0;n<t.length;++n)if(t[n]===e)return!0}else for(var i in t)if(t[i]===e)return!0;return!1},map:function(t,e,n){var i=null;if(n=n||this,u.is_array(t)){i=[];for(var r=0;r<t.length;++r)i.push(e.call(n,t[r],r));return i}for(var s in i={},t)i[s]=e.call(n,t[s],s);return i},keyMap:function(t,e,n){for(var i in result={},n=n||this,t)result[e.call(n,t[i],i)]=t[i];return result},values:function(t){var e=[];for(var n in t)e.push(t[n]);return e},filter:function(t,e,n){if(e=e||function(t){return!!t},u.is_array(t))return t.filter(e,n);var i={};for(var r in t)(n?e.apply(n,[t[r],r]):e(t[r],r))&&(i[r]=t[r]);return i},equals:function(t,e,n){var i=null;if(n&&0<n){for(i in t)if(!(i in e&&this.equals(t[i],e[i],n-1)))return!1;for(i in e)if(!(i in t))return!1;return!0}return t==e},objectify:function(t,e,n){var i={},r=u.is_function(e);u.is_undefined(e)&&(e=!0);for(var s=0;s<t.length;++s)i[t[s]]=r?e.apply(n||this,[t[s],s]):e;return i},arrayify:function(t,n,e){var i=[];return this.iter(t,function(t,e){i.push(n.call(this,t,e))},e),i},objectBy:function(){for(var t={},e=arguments.length/2,n=0;n<e;++n)t[arguments[2*n]]=arguments[2*n+1];return t},specialize:function(t,e,n){var i={},r=n?t:e;for(var s in r)s in t&&t[s]==e[s]||(i[s]=e[s]);return i},merge:function(t,e,n){t=t||{},e=e||{};var i={},r=this.extend(this.keys(t,!0),this.keys(e,!0));for(var s in r){var o=s in n?n[s]:"primary";"primary"==o||"secondary"==o?(s in e||s in t)&&(i[s]="primary"==o?s in e?e[s]:t[s]:s in t?t[s]:e[s]):u.is_function(o)?i[s]=o(t[s],e[s]):u.is_object(o)&&(i[s]=this.merge(t[s],e[s],o))}return i},tree_merge:function(t,e){t=t||{},e=e||{};var n={},i=this.extend(this.keys(t,!0),this.keys(e,!0));for(var r in i)u.is_object(e[r])&&t[r]?n[r]=this.tree_merge(t[r],e[r]):n[r]=r in e?e[r]:t[r];return n},serializeFlatJSON:function(t,n){var i=[];return u.is_array(t)&&t?t.forEach(function(t){i=i.concat(this.serializeFlatJSON(t,n+"[]"))},this):u.is_object(t)&&t?this.iter(t,function(t,e){i=i.concat(this.serializeFlatJSON(t,n?n+"["+e+"]":e))},this):i=[{key:n,value:t}],i},objectToArray:function(t,n,e){var i=[];return this.iter(t,function(t,e){i.push(n.call(this,e,t))},e),i},initArray:function(t,e,n){for(var i=[],r=0;r<t;++r)i.push(e.call(n||this,r));return i},customMerge:function(t,e,n,i){var r={};for(var s in t)r[s]=s in e?n.call(i,s,t[s],e[s]):t[s];for(var o in e)o in t||(r[o]=e[o]);return r},indexizeArray:function(t,e){var n={};return t.forEach(function(t){n[t[e]]=t}),n},filterOutValues:function(t,e){return this.filter(t,function(t){return!e.includes(t)})},mergeSortedArrays:function(t,e,n){n=n||function(t,e){return e<t?1:t<e?-1:0};var i=[],r=0;for(t.forEach(function(t){for(;r<e.length&&0<n(t,e[r]);)i.push(e[r]),r++;for(i.push(t);r<e.length&&0===n(t,e[r]);)r++});r<e.length;)i.push(e[r]),r++;return i}}}),d.define("module:Objs.Scopes",["module:Types"],function(s){return{has:function(t,e){for(var n=t?t.split("."):[],i=0;i<n.length;++i){if(!e||!s.is_object(e))return!1;e=e[n[i]]}return s.is_defined(e)},get:function(t,e){for(var n=t?t.split("."):[],i=0;i<n.length;++i){if(!e||!s.is_object(e))return null;e=e[n[i]]}return e},set:function(t,e,n){if(t){for(var i=t.split("."),r=0;r<i.length-1;++r)i[r]in n&&s.is_object(n[i[r]])||(n[i[r]]={}),n=n[i[r]];n[i[i.length-1]]=e}},unset:function(t,e){if(t){for(var n=t.split("."),i=0;i<n.length-1;++i){if(!e||!s.is_object(e))return;e=e[n[i]]}delete e[n[n.length-1]]}},touch:function(t,e){if(!t)return e;for(var n=t.split("."),i=0;i<n.length;++i)n[i]in e&&s.is_object(e)||(e[n[i]]={}),e=e[n[i]];return e[n[n.length-1]]}}}),d.define("module:Parser.LexerException",["module:Exceptions.Exception"],function(t,e){return t.extend({scoped:e},function(n){return{constructor:function(t,e){n.constructor.call(this,"Lexer error: Unrecognized identifier at "+t.length+"."),this.__head=t,this.__tail=e}}})}),d.define("module:Parser.Lexer",["module:Class","module:Types","module:Objs","module:Parser.LexerException"],function(t,c,_,h,e){return t.extend({scoped:e},function(e){return{constructor:function(t){e.constructor.call(this),this.__patterns=[],_.iter(t,function(t,e){this.__patterns.push({regex:new RegExp("^"+e,"m"),data:c.is_string(t)?{token:t}:t})},this)},lex:function(t){for(var e=[],n="",i=t;i;){for(var r=null,s=null,o=0;o<this.__patterns.length;++o)if(r=this.__patterns[o].regex.exec(i)){s=_.clone(this.__patterns[o].data,1);break}if(!r)throw new h(n,i);if(n+=r[0],i=i.substring(r[0].length),s){for(var u in s)if(c.is_string(s[u]))for(var a=0;a<r.length;++a)s[u]=s[u].replace("$"+a,r[a]);e.push(s)}}return e}}})}),d.define("module:Properties.ObservableMixin",[],function(){return{__observable_guid:"48994ac3-7e0b-4ed5-8995-f146215dc795",get:function(t){},hasKey:function(t){}}}),d.define("module:Properties.PropertiesMixin",["module:Objs.Scopes","module:Objs","module:Strings","module:Types","module:Functions"],function(r,_,h,l,a){return{__properties_guid:"ec816b66-7284-43b1-a945-0600c6abfde3",_notifications:{construct:function(){this.__properties={data:{},watchers:{children:{},eventCount:0,parent:null,key:null},computed:{},bindings:{}},_.iter(this.materializes,function(t){this.materializeAttr(t)},this)},destroy:function(){_.iter(this.__properties.bindings,function(t,e){this.unbind(e)},this),_.iter(this.__properties.computed,function(t,e){this.uncompute(e)},this),this.trigger("destroy")},register_event:function(e){_.iter(["change","unset","deepchange","deepunset","strongdeepchange","strongchange"],function(t){h.starts_with(e,t+":")&&this.__registerWatcher(h.strip_start(e,t+":"),t)},this)},unregister_event:function(e){_.iter(["change","unset","deepchange","deepunset","strongdeepchange","strongchange"],function(t){h.starts_with(e,t+":")&&this.__unregisterWatcher(h.strip_start(e,t+":"),t)},this)}},__registerWatcher:function(t,e){for(var n=t?t.split("."):[],i=this.__properties.watchers,r=0;r<n.length;++r)n[r]in i.children||(i.children[n[r]]={parent:i,eventCount:0,children:{},key:n[r]}),i=i.children[n[r]];i.eventCount++},__unregisterWatcher:function(t,e){for(var n=t?t.split("."):[],i=this.__properties.watchers,r=0;r<n.length;++r)i=i&&i.children[n[r]];if(i)for(i.eventCount--;i.eventCount<=0&&l.is_empty(i.children)&&i.parent;){var s=i.parent;delete s.children[i.key],i=s}},__unsetChanged:function(t,e){this.trigger("unset",t,e);for(var n=t?t.split("."):[],i=this.__properties.watchers,r="",s=t,o=0;o<n.length;++o){if(0<i.eventCount&&this.trigger("deepunset:"+r,e,s),!(n[o]in i.children))return this;i=i.children[n[o]],r=r?r+"."+n[o]:n[o],s=h.first_after(s,".")}function u(t,n,i){l.is_undefined(i)||(0<t.eventCount&&this.trigger("unset:"+n,i),_.iter(t.children,function(t,e){u.call(this,t,n?n+"."+e:e,i[e])},this))}return u.call(this,i,t,e),this},__setChanged:function(t,e,n,s){if(this.trigger("change",t,e,n),this._afterSet(t,e),!this.destroyed()){for(var i=t?t.split("."):[],r=this.__properties.watchers,o="",u=t,a=0;a<i.length;++a){if(0<r.eventCount&&(s||this.trigger("strongdeepchange:"+o,e,n,u),this.trigger("deepchange:"+o,e,n,u)),!(i[a]in r.children))return;r=r.children[i[a]],o=o?o+"."+i[a]:i[a],u=h.first_after(u,".")}c.call(this,r,t,e,n)}function c(t,n,i,r){i!=r&&(0<t.eventCount&&(s||this.trigger("strongchange:"+n,i,r),this.trigger("change:"+n,i,r)),_.iter(t.children,function(t,e){c.call(this,t,n?n+"."+e:e,l.is_object(i)&&i?i[e]:null,l.is_object(r)&&r?r[e]:null)},this))}},materializes:[],_resolveProps:function(t){for(var e={props:this,key:t},n=this.data();t;){if(!n||!l.is_object(n))return e;if(n.__properties_guid===this.__properties_guid)return n._resolveProps(t);var i=h.splitFirst(t,".");if(!(i.head in n))return e;t=i.tail,n=n[i.head]}return e},_canSet:function(t,e){return!0},_beforeSet:function(t,e,n){return e},_afterSet:function(t,e){},getProp:function(t){var e=this._resolveProps(t);return e.props.get(e.key)},setProp:function(t,e){var n=this._resolveProps(t);return n.props.set(n.key,e),this},uncomputeProp:function(t){var e=this._resolveProps(t);return e.props.uncompute(e.key)},computeProp:function(t,e){var n=this._resolveProps(t),i=a.getArguments(arguments);return i[0]=n.key,n.props.compute.apply(n.props.compute,i)},get:function(t){return r.get(t,this.__properties.data)},has:function(t){return r.has(t,this.__properties.data)},hasKey:function(t){return this.has(t)},setAll:function(t){for(var e in t)this.set(e,t[e]);return this},keys:function(t){return _.keys(this.__properties.data,t)},data:function(){return this.__properties.data},getAll:function(){return _.clone(this.__properties.data,1)},clone:function(){return new this.cls(this.getAll())},iterate:function(t,e){return _.iter(this.getAll(),t,e),this},materializeAttr:function(e){return this[e]=function(t){if(0===arguments.length)return this.get(e);this.set(e,t)},this},uncompute:function(t){return t in this.__properties.computed&&(_.iter(this.__properties.computed[t].dependencies,function(t){t.properties.off("change:"+t.key,null,t),t.value&&!t.value.destroyed()&&t.value.off("change update",null,t)},this),delete this.__properties.computed[t]),this},bicompute:function(t,e,n,i){n.call(this);var r=!1;return[[t,n],[e,i]].forEach(function(e){e[0].forEach(function(t){this.on("change:"+t,function(){if(!r)try{r=!0,e[1].call(this),r=!1}catch(t){throw r=!1,t}},this)},this)},this),this},compute:function(e,n){var i=a.matchArgs(arguments,2,{setter:"function",context:{type:"object",def:this},dependencies:!0});this.uncompute(e);var r=[];_.iter(i.dependencies,function(t){l.is_string(t)?r.push({properties:this,key:t}):r.push({properties:t[0],key:t[1]})},this);var s={ignore:0,func:n,context:i.context,setter:i.setter,dependencies:r};this.__properties.computed[e]=s;var o=this;function u(){var t;0<s.ignore||(t=_.map(r,function(t){return t.properties.get(t.key)}),o.set(e,n.apply(i.context,t)))}return _.iter(r,function(n){var t=n.properties.get(n.key);t&&"object"==typeof t&&"on"in t&&"off"in t&&"trigger"in t&&(n.value=t).on("change update",function(){u()},n),n.properties.on("change:"+n.key,function(t,e){n.value=null,e&&"object"==typeof e&&"on"in e&&"off"in e&&"trigger"in e&&e.off("change update",null,n),t&&"object"==typeof t&&"on"in t&&"off"in t&&"trigger"in t&&(n.value=t).on("change update",function(){u()},n),u()},n)},this),u(),this},unbind:function(t,e){if(t in this.__properties.bindings){for(var n=this.__properties.bindings[t].length-1;0<=n;--n){var i=this.__properties.bindings[t][n];e&&e!=i||(i.left&&i.properties.off(null,null,i),i.right&&this.off(null,null,i),this.__properties.bindings[t].splice(n,1),n--)}0===this.__properties.bindings[t].length&&delete this.__properties.bindings[t]}return this},bind:function(i,t,e){var r={key:(e=_.extend({secondKey:i,left:!0,right:!0,deep:!1},e)).secondKey,left:e.left,right:e.right,deep:e.deep,properties:t};this.__properties.bindings[i]=this.__properties.bindings[i]||[],this.__properties.bindings[i].push(r);var s=this;return r.left&&(r.properties.on("strongchange:"+r.key,function(t){s.set(i,t)},r),r.properties.on("unset:"+r.key,function(t){s.unset(i)},r),r.deep&&(r.properties.on("strongdeepchange:"+r.key,function(t,e,n){s.get(i?i+"."+n:n)===t?s.__setChanged(i?i+"."+n:n,t,e,!0):s.set(i?i+"."+n:n,t)},r),r.properties.on("deepunset:"+r.key,function(t,e){s.has(i?i+"."+e:e)?s.unset(i?i+"."+e:e):s.__unsetChanged(i?i+"."+e:e,t)},r)),r.right&&this.has(i)||this.set(i,r.properties.get(r.key)),""===i&&_.iter(r.properties.data(),function(t,e){this.set(e,t)},this)),r.right&&(this.on("strongchange:"+i,function(t){r.properties.set(r.key,t)},r),this.on("unset:"+i,function(t){r.properties.unset(r.key)},r),r.deep&&(this.on("strongdeepchange:"+i,function(t,e,n){r.properties.get(r.key?r.key+"."+n:n)===t?r.properties.__setChanged(r.key?r.key+"."+n:n,t,e,!0):r.properties.set(r.key?r.key+"."+n:n,t)},r),this.on("deepunset:"+i,function(t,e){r.properties.has(r.key?r.key+"."+e:e)?r.properties.unset(r.key?r.key+"."+e:e):r.properties.__unsetChanged(r.key?r.key+"."+e:e,t)},r)),r.left&&!this.has(i)||r.properties.set(r.key,this.get(i)),""===i&&_.iter(this.data(),function(t,e){r.properties.set(e,t)},this)),r.properties.on("destroy",function(){s.destroyed()||s.unbind(i)},r),this},unset:function(t){var e;return this.has(t)&&(e=this.get(t),r.unset(t,this.__properties.data),this.__unsetChanged(t,e)),this},set:function(t,e,n){if(l.is_object(e)&&e&&e.guid==this.__properties_guid)return e.properties&&this.bind(t,e.properties,{secondKey:e.key}),e.func&&this.compute(t,e.func,e.dependencies),this;var i=this.get(t);return i!==(e=this._beforeSet(t,e,i))?(r.set(t,e,this.__properties.data),this.__setChanged(t,e,i)):n&&(this.trigger("change",t,e,i,!0),this.trigger("change:"+t,e,i,!0)),this},binding:function(t){return{guid:this.__properties_guid,properties:this,key:t}},computed:function(t,e){return{guid:this.__properties_guid,func:t,dependencies:e}},pid:function(){return this.cid()},isSubsetOf:function(t){return _.subset_of(this.data(),t.data?t.data():t)},isSupersetOf:function(t){return _.superset_of(this.data(),t.data?t.data():t)}}}),d.define("module:Properties.Properties",["module:Class","module:Objs","module:Events.EventsMixin","module:Properties.ObservableMixin","module:Properties.PropertiesMixin"],function(t,i,e,n,r,s){return t.extend({scoped:s},[e,n,r,function(n){return{constructor:function(t,e){n.constructor.call(this),t&&this.setAll(t),e&&i.iter(e,function(t){this.materializeAttr(t)},this)}}}])}),d.define("module:Sort",["module:Comparators","module:Types","module:Objs"],function(r,p,m){return{sort_object:function(t,n){var e=[];for(var i in t)e.push({key:i,value:t[i]});e.sort(function(t,e){return n(t.key,e.key,t.value,e.value)});for(var r={},s=0;s<e.length;++s)r[e[s].key]=e[s].value;return r},deep_sort:function(t,e){if(e=e||r.byValue,p.is_array(t)){for(var n=0;n<t.length;++n)t[n]=this.deep_sort(t[n],e);return t.sort(e)}if(p.is_object(t)){for(var i in t)t[i]=this.deep_sort(t[i],e);return this.sort_object(t,e)}return t},dependency_sort:function(t,e,n,i){for(var r=p.is_string(e)?function(t){return t[e]}:e,s=p.is_string(n)?function(t){return t[n]}:n,o=p.is_string(i)?function(t){return t[i]}:i,u=t.length,a=[],c={},_={},h=0,h=0;h<u;++h){_[h]=!0;var l=r(t[h],h);c[l]=h,a.push({before:{},after:{}})}for(h=0;h<u;++h)m.iter(s(t[h],h)||[],function(n){return function(t){var e=c[t];p.is_defined(e)&&(a[n].before[e]=!0,a[e].after[n]=!0)}}(h)),m.iter(o(t[h])||[],function(n){return function(t){var e=c[t];p.is_defined(e)&&(a[n].after[e]=!0,a[e].before[n]=!0)}}(h));for(var d=[];!p.is_empty(_);)for(h in _)if(p.is_empty(a[h].after))for(var f in delete _[h],d.push(t[h]),a[h].before)delete a[f].after[h];return d}}}),d.define("module:Strings",["module:Objs"],function(o){return{ucFirst:function(t){return(t+="").charAt(0).toUpperCase()+t.substr(1)},regexEscape:function(t){return t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},asteriskPatternToRegex:function(t){return t.replace(/[-\/\\^$+?.()|[\]{}]/g,"\\$&").replace(/\*/g,".*")},padLeft:function(t,e,n){for(;t.length<n;)t=e+t;return t},padZeros:function(t,e){return this.padLeft(t+"","0",e)},nl2br:function(t){return(t+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />$2")},htmlentities:function(t){return(t+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},JS_ESCAPES:{"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},JS_ESCAPER_REGEX:function(){return this.JS_ESCAPER_REGEX_CACHED||(this.JS_ESCAPER_REGEX_CACHED=new RegExp(o.keys(this.JS_ESCAPES).join("|"),"g")),this.JS_ESCAPER_REGEX_CACHED},js_escape:function(t){var e=this;return t.replace(this.JS_ESCAPER_REGEX(),function(t){return"\\"+e.JS_ESCAPES[t]})},starts_with:function(t,e){return t.substring(0,e.length)==e},ends_with:function(t,e){return-1!==t.indexOf(e,t.length-e.length)},strip_start:function(t,e){return this.starts_with(t,e)?t.substring(e.length):t},strip_end:function(t,e){return this.ends_with(t,e)?t.substring(0,t.length-e.length):t},last_after:function(t,e){return this.splitLast(t,e).tail},first_after:function(t,e){return t.substring(t.indexOf(e)+1,t.length)},EMAIL_ADDRESS_REGEX:/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,STRICT_URL_REGEX:/^\w+:\/\/[^\s]+$/,PERMISSIVE_URL_REGEX:/^[\w\.]+\.(com|de|co\.uk|fr|net|org|edu)[^\s]*$/,is_email_address:function(t){return this.EMAIL_ADDRESS_REGEX.test(t)},STRIP_HTML_TAGS:["script","style","head"],STRIP_HTML_REGEX:/<\/?([a-z][a-z0-9]*)\b[^>]*>?/gi,STRIP_HTML_COMMENT_REGEX:/<![^>]*>/gi,strip_html:function(t){for(var e=t,n=0;n<this.STRIP_HTML_TAGS.length;++n)e=e.replace(new RegExp("<"+this.STRIP_HTML_TAGS[n]+".*</"+this.STRIP_HTML_TAGS[n]+">","i"),"");return e=e.replace(this.STRIP_HTML_REGEX,"").replace(this.STRIP_HTML_COMMENT_REGEX,"")},nltrim:function(t){for(var e=t.replace(/\t/g,"  ").split("\n"),n=null,i=0,i=0;i<e.length;++i){for(var r=0;r<e[i].length&&" "==e[i].charAt(r);)++r;r<e[i].length&&(n=null===n?r:Math.min(r,n))}for(i=0;i<e.length;++i)e[i]=e[i].substring(n);return e.join("\n").trim()},replaceAll:function(t,e,n){for(;0<=t.indexOf(e);)t=t.replace(e,n);return t},capitalize:function(t){return t.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})},pascalCase:function(t){return t.replace(/[A-Z][a-z0-9]/g,function(t){return" "+t}).replace(/[A-Za-z0-9]+/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()}).replace(/[-_\s]/g,"")},camelCase:function(t){var e=this.pascalCase(t);return e.charAt(0).toLowerCase()+e.substr(1)},trainCase:function(t){return this.pascalCase(t).replace(/[A-Z]/g,function(t){return"-"+t}).substring(1)},snakeCase:function(t){return this.trainCase(t).replace(/-/g,"_").toLowerCase()},kebabCase:function(t){return this.trainCase(t).toLowerCase()},email_get_name:function(t){var e=(t=t||"").split("<");return(!(t=e[0].trim())||e.length<2)&&(t=(e=e[e.length-1].split("@"))[0].trim()),t=t.replace(/['"]/g,"").replace(/[\\._@]/g," "),this.capitalize(t)},email_get_email:function(t){var e=(t=t||"").split("<");return t=e[0].trim(),1<e.length&&(t=(e=e[1].split(">"))[0].trim()),t=t.replace(/'/g,"").replace(/"/g,"").trim()},email_get_salutatory_name:function(t){return this.email_get_name(t||"").split(" ")[0]},splitFirst:function(t,e){var n=t.indexOf(e);return{head:0<=n?t.substring(0,n):t,tail:0<=n?t.substring(n+e.length):""}},splitLast:function(t,e){var n=t.lastIndexOf(e);return{head:0<=n?t.substring(0,n):"",tail:0<=n?t.substring(n+e.length):t}},regexReplaceGroups:function(t,e){for(var n=/\(.*?\)/,i=function(t){return r||t.substring(1,t.length-1)};0<e.length;){var r=e.shift();t=t.replace(n,i)}return t},namedCaptureRegex:function(t){var r={},s=0,n=new RegExp(t.replace(/\([^)]+\)/gi,function(t){var e;return"?"!=t.charAt(1)&&0<t.indexOf(":")&&(e=t.indexOf(":"),r[t.substring(1,e)]=s,t="("+t.substring(e+1,t.length-1)+")"),s++,t})),i=function(e){return o.map(r,function(t){return e[t+1]})};return{regex:n,map:i,exec:function(t){var e=n.exec(t);return e?i(e):null},mapBack:function(t){for(var e=[],n=0;n<s;++n)e.push(null);for(var i in t)i in r&&(e[r[i]]=t[i]);return e}}},ordinalSuffix:function(t){var e=t%10,n=t%100;return 1==e&&11!=n?t+"st":2==e&&12!=n?t+"nd":3==e&&13!=n?t+"rd":t+"th"},__cachedRegExp:{},cachedRegExp:function(t,e){return e=e||"",this.__cachedRegExp[t]||(this.__cachedRegExp[t]={}),this.__cachedRegExp[t][e]||(this.__cachedRegExp[t][e]=new RegExp(t,e)),this.__cachedRegExp[t][e]},IP_ADDRESS_REGEXP:/^\d+\.\d+\.\d+\.\d+$/,isIPAddress:function(t){return this.IP_ADDRESS_REGEXP.test(t)},NORMALIZE_SEARCH_TEXT_MAPS:{"\\u00dc":"Ue","\\u00fc":"ue","\\u00c4":"Ae","\\u00e4":"ae","\\u00d6":"Oe","\\u00f6":"oe","\\u00df":"ss","\\W":" ","\\s+":" "},NORMALIZE_SEARCH_TEXT_MAPS_REGEX:function(){return this.NORMALIZE_SEARCH_TEXT_MAPS_CACHED||(this.NORMALIZE_SEARCH_TEXT_MAPS_CACHED=[],o.iter(this.NORMALIZE_SEARCH_TEXT_MAPS,function(t,e){this.NORMALIZE_SEARCH_TEXT_MAPS_CACHED.push({search:new RegExp(e,"g"),replace:t})},this)),this.NORMALIZE_SEARCH_TEXT_MAPS_CACHED},normalizeSearchText:function(e){return o.iter(this.NORMALIZE_SEARCH_TEXT_MAPS_REGEX(),function(t){e=e.replace(t.search,t.replace)}),e.trim()}}}),d.define("module:Structures.AvlTree",function(){return{empty:function(){return null},singleton:function(t){return{data:t,left:null,right:null,height:1,length:1}},min:function(t){return t.left?this.min(t.left):t.data},max:function(t){return t.right?this.max(t.right):t.data},height:function(t){return t?t.height:0},length:function(t){return t?t.length:0},__height_join:function(t,e){return 1+Math.max(this.height(t),this.height(e))},length_join:function(t,e){return 1+this.length(t)+this.length(e)},__create:function(t,e,n){return{data:t,left:e,right:n,height:this.__height_join(e,n),length:this.length_join(e,n)}},balance:function(t,e,n){return this.height(e)>this.height(n)+2?this.height(e.left)>=this.height(e.right)?this.__create(e.data,e.left,this.__create(t,e.right,n)):this.__create(e.right.data,this.__create(e.data,e.left,e.right.left),this.__create(t,e.right.right,n)):this.height(n)>this.height(e)+2?this.height(n.right)>=this.height(n.left)?this.__create(n.data,this.__create(t,e,n.left),n.right):this.__create(n.left.data,this.__create(t,e,n.left.left),this.__create(n.data,n.left.right,n.right)):this.__create(t,e,n)},__add_left:function(t,e){return e?this.balance(e.data,this.__add_left(t,e.left),e.right):this.singleton(t)},__add_right:function(t,e){return e?this.balance(e.data,e.data,this.__add_right(t,e.right)):this.singleton(t)},__join:function(t,e,n){return e?n?this.height(e)>this.height(n)+2?this.balance(e.data,e.left,this.__join(t,e.right,n)):this.height(n)>this.height(e)+2?this.balance(n.data,this.__join(t,e,n.left),n.right):this.__create(t,e,n):this.__add_right(t,e):this.__add_left(t,n)},take_min:function(t){if(!t.left)return[t.data,t.right];var e=this.take_min(t.left);return[e[0],this.__join(t.data,e[1],t.right)]},take_max:function(t){if(!t.right)return[t.data,t.left];var e=this.take_max(t.right);return[e[0],this.__join(t.data,t.left,e[1])]},take_min_iter:function(t){return t?t.left?this.take_min_iter(this.__create(t.left.data,t.left.left,this.__create(t.data,t.left.right,t.right))):[t.data,t.left]:null},take_max_iter:function(t){return t?t.right?this.take_max_iter(this.__create(t.right.data,this.__create(t.data,t.left,t.right.left),t.right.right)):[t.data,t.right]:null}}}),d.define("module:Structures.TreeMap",["module:Structures.AvlTree"],function(o){return{empty:function(t){return{root:null,compare:t||function(t,e){return e<t?1:t<e?-1:0}}},is_empty:function(t){return!t.root},length:function(t){return t.root?t.root.length:0},__add:function(t,e,n,i){var r={key:t,value:e};if(!i)return o.singleton(r);var s=n.compare(t,i.data.key);return 0===s?(i.data=r,i):s<0?o.balance(i.data,this.__add(t,e,n,i.left),i.right):o.balance(i.data,i.left,this.__add(t,e,n,i.right))},add:function(t,e,n){return n.root=this.__add(t,e,n,n.root),n},singleton:function(t,e,n){return this.add(t,e,this.empty(n))},__find:function(t,e,n){if(!n)return null;var i=e.compare(t,n.data.key);return 0===i?n.data.value:this.__find(t,e,i<0?n.left:n.right)},find:function(t,e){return this.__find(t,e,e.root)},__iterate:function(t,e,n,i,r){return!e||this.__iterate(t,r?e.right:e.left,n,i,r)&&!1!==n.call(i,e.data.key,e.data.value)&&this.__iterate(t,r?e.left:e.right,n,i,r)},iterate:function(t,e,n,i){this.__iterate(t,t.root,e,n,i)},__iterate_from:function(t,e,n,i,r,s){if(!n)return!0;var o=e.compare(t,n.data.key)*(s?-1:1);return!(o<0&&!this.__iterate_from(t,e,s?n.right:n.left,i,r,s))&&(!(o<=0&&!1===i.call(r,n.data.key,n.data.value))&&this.__iterate_from(t,e,s?n.left:n.right,i,r,s))},iterate_from:function(t,e,n,i,r){this.__iterate_from(t,e,e.root,n,i,r)},iterate_range:function(t,n,i,r,s,o){this.iterate_from(t,i,function(t,e){return i.compare(t,n)*(o?-1:1)<=0&&!1!==r.call(s,t,e)},this,o)},take_min:function(t){var e=o.take_min(t.root);return e[1]={compare:t.compare,root:e[1]},e},__treeSizeLeft:function(t,e,n){var i=e.compare(t,n.data.key);return i<0?this.__treeSizeLeft(t,e,n.left):1+(n.left?n.left.length:0)+(0<i?this.__treeSizeLeft(t,e,n.right):0)},__treeSizeRight:function(t,e,n){var i=e.compare(t,n.data.key);return 0<i?this.__treeSizeRight(t,e,n.right):1+(n.right?n.right.length:0)+(i<0?this.__treeSizeRight(t,e,n.left):0)},__distance:function(t,e,n,i){var r=n.compare(t,i.data.key),s=n.compare(e,i.data.key);return 0<r||s<0?this.__distance(t,e,n,0<r?i.right:i.left):1+(0<s?this.__treeSizeLeft(e,n,i.right):0)+(r<0?this.__treeSizeRight(t,n,i.left):0)},treeSizeLeft:function(t,e){return this.__treeSizeLeft(t,e,e.root)},treeSizeRight:function(t,e){return this.__treeSizeRight(t,e,e.root)},distance:function(t,e,n){return n.compare(t,e)<0?this.__distance(t,e,n,n.root)-1:0}}}),d.define("module:Templates",["module:Types","module:Strings"],function(c,_){return{tokenize:function(s){if(c.is_array(s))return s;var o=[],u=0,a=this;return s.replace(a.SYNTAX_REGEX(),function(t,e,n,i,r){return u<r&&o.push({type:a.TOKEN_STRING,data:_.js_escape(s.slice(u,r))}),i&&o.push({type:a.TOKEN_CODE,data:i}),e&&o.push({type:a.TOKEN_EXPR,data:e}),n&&o.push({type:a.TOKEN_ESC,data:n}),u=r+t.length,t}),o},compile:function(t,e){c.is_string(t)&&(t=this.tokenize(t));for(var n=(e=e||{}).start_index||0,i=e.end_index||t.length,r="__p+='",s=n;s<i;++s)switch(t[s].type){case this.TOKEN_STRING:r+=t[s].data;break;case this.TOKEN_CODE:r+="';\n"+t[s].data+"\n__p+='";break;case this.TOKEN_EXPR:r+="'+\n((__t=("+t[s].data+"))==null?'':__t)+\n'";break;case this.TOKEN_ESC:r+="'+\n((__t=("+t[s].data+"))==null?'':Helpers.Strings.htmlentities(__t))+\n'"}r="var __t,__p='',__j=Array.prototype.join,echo=function(){__p+=__j.call(arguments,'');};\n"+(r="with(obj||{}){\n"+(r+="';\n")+"}\n")+"return __p;\n";var o=new Function("obj","Helpers",r),u=function(t){return o.call(this,t,{Strings:_})};return u.source="function(obj, Helpers){\n"+r+"}",u},SYNTAX:{OPEN:"{%",CLOSE:"%}",MODIFIER_CODE:"",MODIFIER_EXPR:"=",MODIFIER_ESC:"-"},SYNTAX_REGEX:function(){var t=this.SYNTAX;return this.SYNTAX_REGEX_CACHED||(this.SYNTAX_REGEX_CACHED=new RegExp(t.OPEN+t.MODIFIER_EXPR+"([\\s\\S]+?)"+t.CLOSE+"|"+t.OPEN+t.MODIFIER_ESC+"([\\s\\S]+?)"+t.CLOSE+"|"+t.OPEN+t.MODIFIER_CODE+"([\\s\\S]+?)"+t.CLOSE+"|$","g")),this.SYNTAX_REGEX_CACHED},TOKEN_STRING:1,TOKEN_CODE:2,TOKEN_EXPR:3,TOKEN_ESC:4}}),d.define("module:Templates.Template",["module:Class","module:Templates"],function(t,n,e){return t.extend({scoped:e},function(e){return{constructor:function(t){e.constructor.call(this),this.__tokens=n.tokenize(t),this.__compiled=n.compile(this.__tokens)},evaluate:function(t){return this.__compiled.apply(this,[t])}}})}),d.define("module:TimeFormat",["module:Time","module:Strings","module:Objs"],function(a,n,c){return{formatMappings:{HH:function(t){return n.padZeros(a.timeModulo(t,"hour","floor"),2)},H:function(t){return a.timeModulo(t,"hour","floor")},"h+":function(t){return a.timeComponent(t,"hour","floor")},hh:function(t){var e=0===(e=a.timeModulo(t,"hour","floor"))?12:12<e?e-12:e;return n.padZeros(e," ",2)},h:function(t){var e=a.timeModulo(t,"hour","floor");return e=0===e?12:12<e?e-12:e},"M+":function(t){return a.timeComponent(t,"minute","floor")},MM:function(t){return n.padZeros(a.timeModulo(t,"minute","floor"),2)},M:function(t){return a.timeModulo(t,"minute","floor")},"s+":function(t){return a.timeComponent(t,"second","floor")},ss:function(t){return n.padZeros(a.timeModulo(t,"second","floor"),2)},s:function(t){return a.timeModulo(t,"second","floor")},mmm:function(t){return new Date(t).toUTCString().split(" ")[2]},mm:function(t){return n.padZeros(a.timeComponentGet(t,"month")+1,2)},m:function(t){return a.timeComponentGet(t,"month")+1},"d+":function(t){return a.timeComponent(t,"day","floor")},dddd:function(t){return new Date(t).toUTCString().substring(0,3)+({2:"s",3:"nes",4:"rs",6:"ur"}[a.timeComponentGet(t,"weekday")]||"")+"day"},ddd:function(t){return new Date(t).toUTCString().substring(0,3)},dd:function(t){return n.padZeros(a.timeComponentGet(t,"day")+1,2)},d:function(t){return a.timeComponentGet(t,"day")+1},yyyy:function(t){return a.timeComponentGet(t,"year")},yy:function(t){return a.timeComponentGet(t,"year")%100},"l+":function(t){return t.getTime()},l:function(t){return a.timeComponentGet(t,"millisecond")},L:function(t){return Math.floor(a.timeComponentGet(t,"millisecond")/10)},tt:function(t){return a.timeModulo(t,"hour","floor")<12?"am":"pm"},t:function(t){return a.timeModulo(t,"hour","floor")<12?"a":"p"},TT:function(t){return a.timeModulo(t,"hour","floor")<12?"AM":"PM"},T:function(t){return a.timeModulo(t,"hour","floor")<12?"A":"P"},o:function(t,e){return(0<(e=Math.floor(e/1e3/60))?"-":"+")+n.padZeros(100*Math.floor(Math.abs(e)/60)+Math.abs(e)%60,4)}},ELAPSED_HOURS_MINUTES_SECONDS:"h+:MM:ss",ELAPSED_MINUTES_SECONDS:"M+:ss",FULL_YEAR:"yyyy",LETTER_MONTH:"mmm",LETTER_MONTH_AND_DAY:"mmm d",WEEKDAY:"ddd",HOURS_MINUTES_TT:"hh:MM tt",format:function(t,e,n){e=e||a.now();var i=a.timeToTimezoneBasedDate(e,n),r=a.timezoneBias(n),s=t,o=[];c.iter(this.formatMappings,function(t,e){var n;0<=s.indexOf(e)&&(n=o.length,o.push(t(i,r)),s=s.replace(e,"$"+n+"$"))},this);for(var u=0;u<o.length;++u)s=s.replace("$"+u+"$",o[u]);return s},monthString:function(t){return this.format("mmm",a.encodePeriod({month:t}))},weekdayString:function(t){return this.format("ddd",a.encodePeriod({weekday:t}))},weekNumber:function(t,e){var n=new Date(t+a.timezoneBias(e)),i=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate())),r=i.getUTCDay()||7;i.setUTCDate(i.getUTCDate()+4-r);var s=new Date(Date.UTC(i.getUTCFullYear(),0,1));return Math.ceil(((i-s)/864e5+1)/7)},formatRelativeMostSignificant:function(t,e,n){if(t===Infinity)return"Someday";e=e||a.now();var i=a.decodeTime(t,n),r=a.decodeTime(e,n);return i.year===r.year&&i.month===r.month&&i.day===r.day-1?"Yesterday "+this.format("hh:MM tt",t,n):i.year===r.year&&i.month===r.month&&i.day===r.day?"Today "+this.format("hh:MM tt",t,n):i.year===r.year&&i.month===r.month&&i.day===r.day+1?"Tomorrow "+this.format("hh:MM tt",t,n):Math.abs(e-t)<6048e5&&i.weekday!==r.weekday?this.format("dddd",t,n):i.year===r.year&&i.month+1>=r.month||i.year+1===r.year&&i.month+1>=r.month+12-1?this.format("mmm d",t,n):i.year===r.year||i.year+1===r.year&&i.month>r.month?this.format("mmm",t,n):this.format("yyyy",t,n)}}}),d.define("module:Time",[],function(){return{__components:{year:{set:function(t,e){t.setUTCFullYear(e)},get:function(t){return t.getUTCFullYear()}},month:{set:function(t,e){t.setUTCMonth(e)},get:function(t){return t.getUTCMonth()}},day:{dependencies:{weekday:!0},set:function(t,e){t.setUTCDate(e+1)},get:function(t){return t.getUTCDate()-1},milliseconds:864e5},weekday:{dependencies:{day:!0,month:!0,year:!0},set:function(t,e){t.setUTCDate(t.getUTCDate()+e-t.getUTCDay())},get:function(t){return t.getUTCDay()}},hour:{set:function(t,e){t.setUTCHours(e)},get:function(t){return t.getUTCHours()},max:23,milliseconds:36e5},minute:{set:function(t,e){t.setUTCMinutes(e)},get:function(t){return t.getUTCMinutes()},max:59,milliseconds:6e4},second:{set:function(t,e){t.setUTCSeconds(e)},get:function(t){return t.getUTCSeconds()},max:59,milliseconds:1e3},millisecond:{set:function(t,e){t.setUTCMilliseconds(e)},get:function(t){return t.getUTCMilliseconds()},max:999,milliseconds:1}},getTimezoneOffset:function(){return this.__timezoneOffset===undefined?(new Date).getTimezoneOffset():this.__timezoneOffset},setTimezoneOffset:function(t){this.__timezoneOffset=t},timezoneBias:function(t){return!0===t&&(t=this.getTimezoneOffset()),null!=t&&!1!==t||(t=0),60*t*1e3},timeToDate:function(t,e){return new Date(t+this.timezoneBias(e))},dateToTime:function(t,e){return t.getTime()-this.timezoneBias(e)},timeToTimezoneBasedDate:function(t,e){return new Date(t-this.timezoneBias(e))},timezoneBasedDateToTime:function(t,e){return t.getTime()+this.timezoneBias(e)},decodeTime:function(t,e){var n=this.timeToTimezoneBasedDate(t||this.now(),e),i={};for(var r in this.__components)i[r]=this.__components[r].get(n);return i},encodeTime:function(t,e){return this.updateTime(this.now(),t,e)},encodePeriod:function(t){return this.incrementTime(0,t)},updateTime:function(t,e,n){var i=this.timeToTimezoneBasedDate(t,n);for(var r in e)this.__components[r].set(i,e[r]);return this.timezoneBasedDateToTime(i,n)},now:function(t){return this.dateToTime(new Date,t)},uniqueAtLeastNow:function(t,e){var n=this.now(e);return this.__unique_at_least_now&&this.__unique_at_least_now>=n&&(n=this.__unique_at_least_now+(t||1)),this.__unique_at_least_now=n},perfNow:function(){return"undefined"==typeof performance?(new Date).getTime():performance.now()},incrementTime:function(t,e){var n=this.timeToDate(t);for(var i in e)this.__components[i].set(n,this.__components[i].get(n)+e[i]);return this.dateToTime(n)},floorTime:function(t,e,n){var i=this.timeToTimezoneBasedDate(t,n),r=!1;for(var s in this.__components){var o=this.__components[s];!(r=r||s==e)||o.dependencies&&o.dependencies[e]||o.set(i,0)}return this.timezoneBasedDateToTime(i,n)},ago:function(t,e){return this.now(e)-t},timeComponent:function(t,e,n){return Math[n||"floor"](t/this.__components[e].milliseconds)},timeComponentGet:function(t,e,n){return this.__components[e].get(this.timeToTimezoneBasedDate(t,n))},timeModulo:function(t,e,n){return this.timeComponent(t,e,n)%(this.__components[e].max+1)}}}),d.define("module:Tokens",function(){return{generate_token:function(t){t=t||16;for(var e="";e.length<t;)e+=Math.random().toString(36).substr(2);return e.substr(0,t)},simple_hash:function(t){var e=0;if(!t.length)return e;for(var n=0,i=t.length;n<i;++n)e=(e<<5)-e+t.charCodeAt(n),e&=e;return Math.abs(e)}}}),d.define("module:Trees.TreeNavigator",function(){return{nodeRoot:function(){},nodeId:function(t){},nodeParent:function(t){},nodeChildren:function(t){},nodeWatch:function(t,e,n){},nodeUnwatch:function(t,e,n){},nodeData:function(t){}}}),d.define("module:Trees.TreeQueryEngine",["module:Class","module:Parser.Lexer","module:Trees.TreeQueryObject"],function(t,n,i,e){return t.extend({scoped:e},function(e){return{constructor:function(t){e.constructor.call(this),this.__navigator=t,this.__lexer=this._auto_destroy(new n({"<\\+":{token:"Up"},"<":{token:"Up",single:!0},">\\+":{token:"Down"},">":{token:"Down",single:!0},"\\[s*([a-zA-Z]+)s*=s*'([^']*)'s*\\]":{token:"Selector",key:"$1",value:"$2"},'\\[s*([a-zA-Z]+)s*=s*"([^\']*)"s*\\]':{token:"Selector",key:"$1",value:"$2"},s:null}))},query:function(t,e){return new i(this.__navigator,t,this.__lexer.lex(e))}}})}),d.define("module:Trees.TreeQueryObject",["module:Class","module:Events.EventsMixin","module:Objs","module:Types"],function(t,e,a,r,n){return t.extend({scoped:n},[e,function(i){return{constructor:function(t,e,n){i.constructor.call(this),this.__navigator=t,this.__node=e,this.__query=n,this.__result={},this.__partials={},this.__ids=0,this.__register(e,0,{})},destroy:function(){a.iter(this.__partials,function(e){a.iter(e.partials,function(t){this.__navigator.nodeUnwatch(e.node,null,t)},this)},this),i.destroy.call(this)},result:function(){var e=[];return a.iter(this.__result,function(t){e.push(t.node)}),e},__register:function(t,e){var n=this.__navigator.nodeId(t);this.__partials[n]||(this.__partials[n]={node:t,partials:{}});var i=this.__partials[n];this.__ids++;for(var r={owner:i,id:this.__ids,query_index_start:e,query_index_next:e,query_index_last:e,partial_match:!1,partial_final:e>=this.__query.length,partial_data:!1,partial_children:!1,partial_parent:!1,partial_star:!1,parent:null,deps:{}},s=(i.partials[r.id]=r).query_index_start;s<this.__query.length;++s){if("Selector"!=this.__query[s].token){"Up"==this.__query[s].token?r.partial_parent=!0:"Down"==this.__query[s].token&&(r.partial_children=!0),r.partial_star=!this.__query[s].single,r.partial_star||(r.query_index_next=s+1);break}r.partial_data=!0,r.query_index_next=s+1,r.partial_final=s+1==this.__query.length}r.query_index_last=r.partial_star?r.query_index_next+1:r.query_index_next;var o=this;return this.__navigator.nodeWatch(t,function(t,e){"data"==t&&r.partial_data&&o.__update(r),"remove"==t&&o.__unregisterPartial(r),"addChild"==t&&r.partial_children&&r.partial_match&&o.__addDependentPartial(r,e)},r),this.__update(r),r},__unregisterPartial:function(t){var e=t.owner,n=e.node,i=this.__navigator.nodeId(n);t.partial_final&&this.__result[i]&&(this.__result[i].count--,this.__result[i].count<=0&&(delete this.__result[i],this.trigger("remove",n),this.trigger("change"))),a.iter(t.deps,this.__unregisterPartial,this),t.parent&&delete t.parent.deps[t.id],this.__navigator.nodeUnwatch(n,null,t),delete e.partials[t.id],r.is_empty(e.partials)&&delete this.__partials[i]},__addDependentPartial:function(e,t){var n=[];n.push(this.__register(t,e.query_index_next)),e.partial_star&&n.push(this.__register(t,e.query_index_next+1)),a.iter(n,function(t){(e.deps[t.id]=t).parent=e},this)},__update:function(e){for(var t,n=!0,i=e.owner.node,r=this.__navigator.nodeId(i),s=this.__navigator.nodeData(i),o=e.query_index_start;o<e.query_index_last;++o){var u=this.__query[o];if("Selector"!=u.token)break;if(s[u.key]!=u.value){n=!1;break}}n!=e.partial_match&&((e.partial_match=n)?e.partial_final?this.__result[r]?this.__result[r].count++:(this.__result[r]={node:i,count:1},this.trigger("add",i),this.trigger("change")):e.partial_parent?(t=this.__navigator.nodeParent(i))&&this.__addDependentPartial(e,t):e.partial_children&&a.iter(this.__navigator.nodeChildren(i),function(t){this.__addDependentPartial(e,t)},this):(e.partial_final&&(this.__result[r].count--,this.__result[r].count<=0&&(delete this.__result[r],this.trigger("remove",i),this.trigger("change"))),a.iter(e.deps,this.__unregisterPartial,this)))}}}])}),d.define("module:Types",function(){return{is_object:function(t){return"object"==typeof t},is_array:function(t){return Array.isArray(t)},is_undefined:function(t){return void 0===t},is_null:function(t){return null===t},is_none:function(t){return this.is_undefined(t)||this.is_null(t)},is_defined:function(t){return void 0!==t},is_empty:function(t){return this.is_none(t)||this.is_array(t)&&0===t.length||this.is_object(t)&&this.is_empty_object(t)},is_empty_object:function(t){for(var e in t)return!1;return!0},is_string:function(t){return"string"==typeof t},is_function:function(t){return"function"==typeof t},is_boolean:function(t){return"boolean"==typeof t},compare:function(t,e){if(this.is_boolean(t)&&this.is_boolean(e))return t===e?0:t?1:-1;if(this.is_array(t)&&this.is_array(e)){for(var n=t.length,i=e.length,r=Math.min(n,i),s=0;s<r;++s){var o=this.compare(t[s],e[s]);if(0!==o)return o}return n===i?0:i<n?1:-1}return t.localeCompare(e)},parseBool:function(t){return this.is_boolean(t)?t:"true"===t||""===t||"false"!==t&&null},parseArray:function(t){return this.is_string(t)?t.split(","):t},type_of:function(t){return this.is_array(t)?"array":typeof t},isNumber:function(t){return"number"==typeof t},parseInt:function(t){return this.isNumber(t)?t:parseInt(t,10)},parseFloat:function(t){return this.isNumber(t)?t:parseFloat(t)},parseDateTime:function(t){if("number"==typeof t)return t;if(null===t||t===undefined)return 0;"object"==typeof t&&(t=t.toString());var e=new Date(t);return isNaN(e.getTime())?parseInt(t,10):e.getTime()},parseType:function(t,e){switch(e.toLowerCase()){case"bool":case"boolean":return this.parseBool(t);case"int":case"integer":case"number":return this.parseInt(t);case"date":case"time":case"datetime":return this.parseDateTime(t);case"float":case"double":return this.parseFloat(t);case"array":return this.parseArray(t);case"jsonarray":return"string"==typeof t?JSON.parse(t):t;case"object":case"json":return"string"==typeof t?JSON.parse(t):t;case"id":return"object"==typeof t&&t?t.toString():t;default:return t}},parseTypes:function(t,e){var n={};for(var i in t)n[i]=i in e?this.parseType(t[i],e[i]):t[i];return n},objectType:function(t){if(!this.is_object(t))return null;var e=t.toString().match(/\[object (.*)\]/);return e?e[1]:null},is_pure_object:function(t){return this.is_object(t)&&("[object]"===t.toString().toLowerCase()||"[object object]"===t.toString().toLowerCase())},typefy:function(t){var n=function(e){var t=e.length;return["'",'"'].forEach(function(t){0===e.indexOf(t)&&e.lastIndexOf(t)===e.length-t.length&&(e=e.substring(t.length,e.length-2*t.length+1))}),(e=e.trim()).length<t?n(e):e};switch(typeof t){case"object":if(Array.isArray(t))return t.map(typefy);for(var e in t)t[e]=typefy(t[e]);return t;case"string":return"true"===(t=n(t))||"false"!==t&&(parseInt(t,10)+""===t?parseInt(t,10):t);default:return t}}}}),d.define("module:Channels.Sender",["module:Class","module:Events.EventsMixin"],function(t,e,n){return t.extend({scoped:n},[e,{send:function(t,e,n){this.trigger("send",t,e),this._send(t,e,n)},_send:function(t,e,n){},connectToReceiver:function(t){return t.connectToSender(this),this}}])}),d.define("module:Channels.Receiver",["module:Class","module:Events.EventsMixin"],function(t,e,n){return t.extend({scoped:n},[e,{_receive:function(t,e){this.trigger("receive",t,e),this.trigger("receive:"+t,e)},connectToSender:function(t){return this.on("receive",t.send,t),this}}])}),d.define("module:Channels.ReceiverSender",["module:Channels.Sender","module:Channels.Receiver","module:Async"],function(t,r,i,e){return t.extend({scoped:e},function(r){return{constructor:function(t,e,n,i){r.constructor.call(this),this.__receiver=t,this.__async=e,this.__delay=n,this.__json=i},_send:function(t,e,n){this.__json&&(e=JSON.parse(JSON.stringify(e))),this.__async?i.eventually(function(){this.__receiver._receive(t,e)},this,this.__delay):this.__receiver._receive(t,e)}}},{createPair:function(t,e,n){var i=new r;return{sender:new this(i,t,e,n),receiver:i}}})}),d.define("module:Channels.ReadySender",["module:Channels.Sender"],function(t,e){return t.extend({scoped:e},function(e){return{constructor:function(t){e.constructor.call(this),this.__cache=[],this.__sender=t},_send:function(t,e,n){this.__ready?this.__sender.send(t,e,n):this.__cache.push({message:t,data:e,serializerInfo:n})},ready:function(){this.__ready=!0,this.__cache.forEach(function(t){this.__sender.send(t.message,t.data,t.serializerInfo)},this),this.__cache=[]},unready:function(){this.__ready=!1}}})}),d.define("module:Channels.SenderMultiplexer",["module:Channels.Sender"],function(t,e){return t.extend({scoped:e},function(n){return{constructor:function(t,e){n.constructor.call(this),this.__sender=t,this.__prefix=e},_send:function(t,e,n){this.__sender.send(this.__prefix+":"+t,e,n)}}})}),d.define("module:Channels.ReceiverMultiplexer",["module:Channels.Receiver","module:Strings"],function(t,i,e){return t.extend({scoped:e},function(n){return{constructor:function(t,e){n.constructor.call(this),this.__receiver=t,this.__prefix=e,this.__receiver.on("receive",function(t,e){i.starts_with(t,this.__prefix+":")&&this._receive(i.strip_start(t,this.__prefix+":"),e)},this)}}})}),d.define("module:Channels.SimulatorSender",["module:Channels.Sender"],function(t,e){return t.extend({scoped:e},function(e){return{online:!0,constructor:function(t){e.constructor.call(this),this.__sender=t},_send:function(t,e){this.online&&this.__sender.send(t,e)}}})}),d.define("module:Channels.SimulatorReceiver",["module:Channels.Receiver"],function(t,e){return t.extend({scoped:e},function(e){return{online:!0,constructor:function(t){e.constructor.call(this),this.__receiver=t,this.__receiver.on("receive",function(t,e){this.online&&this._receive(t,e)},this)}}})}),d.define("module:Channels.TransportChannel",["module:Class","module:Objs","module:Timers.Timer","module:Time","module:Promise"],function(t,r,s,o,u,e){return t.extend({scoped:e},function(i){return{constructor:function(t,e,n){i.constructor.call(this),this.__sender=t,this.__receiver=e,this.__options=r.extend(n,{timeout:1e4,tries:1,timer:500}),this.__options.auto_destroy&&(this.auto_destroy(t),this.auto_destroy(e)),this.__receiver.on("receive:send",function(t){this.__reply(t)},this),this.__receiver.on("receive:reply",function(t){this.__complete(t)},this),this.__sent_id=0,this.__sent={},this.__received={},this.__timer=this._auto_destroy(new s({delay:this.__options.timer,context:this,fire:this.__maintenance}))},_reply:function(t,e){},send:function(t,e,n){var i=u.create();return(n=n||{}).stateless?(this.__sender.send("send",{message:t,data:e,stateless:!0},n.serializerInfo),i.asyncSuccess(!0)):(this.__sent_id++,this.__sent[this.__sent_id]={message:t,data:e,tries:1,time:o.now(),id:this.__sent_id,promise:i},this.__sender.send("send",{message:t,data:e,id:this.__sent_id},n.serializerInfo)),i},__reply:function(e){e.stateless?this._reply(e.message,e.data):this.__received[e.id]?this.__received[e.id].returned&&this.__sender.send("reply",{id:e.id,reply:e.reply,success:e.success}):(this.__received[e.id]=e,this.__received[e.id].time=o.now(),this.__received[e.id].returned=!1,this.__received[e.id].success=!1,u.value(this._reply(e.message,e.data)).success(function(t){this.__received[e.id].reply=t,this.__received[e.id].success=!0},this).error(function(t){t&&t.constructor&&t.constructor===Error&&(t=t.toString()),this.__received[e.id].reply=t},this).callback(function(){this.__received[e.id].returned=!0,this.__sender.send("reply",{id:e.id,reply:e.reply,success:e.success})},this))},__complete:function(t){this.__sent[t.id]&&(this.__sent[t.id].promise[t.success?"asyncSuccess":"asyncError"](t.reply),this.__sent&&delete this.__sent[t.id])},__maintenance:function(){var t=o.now();for(var e in this.__received){this.__received[e].time+this.__options.tries*this.__options.timeout<=t&&delete this.__received[e]}for(var n in this.__sent){var i=this.__sent[n];i.time+i.tries*this.__options.timeout<=t&&(i.tries<this.__options.tries?(i.tries++,this.__sender.send("send",{message:i.message,data:i.data,id:i.id})):(i.promise.asyncError({message:i.message,data:i.data}),delete this.__sent[n]))}}}})}),d.define("module:Classes.ConditionalInstance",["module:Class","module:Objs"],function(t,i,e){return t.extend({scoped:e},function(e){return{constructor:function(t){e.constructor.call(this),this._options=this.cls._initializeOptions(t)}}},{_initializeOptions:function(t){return t},supported:function(t){return!1}},{__registry:[],register:function(t,e){this.__registry.push({cls:t,priority:e})},match:function(e){e=this._initializeOptions(e);var n=null;return i.iter(this.__registry,function(t){(!n||n.priority<t.priority)&&t.cls.supported(e)&&(n=t)},this),n},create:function(t){var e=this.match(t);return e?new e.cls(t):null},anySupport:function(t){return null!==this.match(t)}})}),d.define("module:Classes.OptimisticConditionalInstance",["module:Class","module:Objs","module:Promise"],function(t,e,n,i){return t.extend({scoped:i},function(n){return{constructor:function(t,e){n.constructor.call(this),this._transitionals={}},_initializer:function(){},_initialize:function(){return this._initializer().success(function(){this._afterInitialize()},this)},transitionals:function(){return this._transitionals},_afterInitialize:function(){}}},{},{__registry:[],register:function(t,e){this.__registry.push({cls:t,priority:e})},create:function(s){var o=n.create(),u=e.clone(this.__registry,1),a={},c=function(){if(u.length){for(var t=-1,e=-1,n=0;n<u.length;++n)u[n].priority>t&&(t=u[n].priority,e=n);var i=u[e].cls;u.splice(e,1);var r=new i(s,a);r._initialize().error(function(){a=r.transitionals(),r.destroy(),c.call(this)},this).success(function(){o.asyncSuccess(r)})}else o.asyncError(!0)};return c.call(this),o}})}),d.define("module:Classes.LocaleMixin",function(){return{_clearLocale:function(){},_setLocale:function(t){},getLocale:function(){return this.__locale},clearLocale:function(){this._clearLocale(),this.__locale=null},setLocale:function(t){this.clearLocale(),this.__locale=t,this._setLocale(t)},isLocaleSet:function(){return!!this.__locale},setWeakLocale:function(t){this.isLocaleSet()||this.setLocale(t)}}}),d.define("module:Classes.LocaleAggregator",["module:Class","module:Classes.LocaleMixin","module:Objs"],function(t,e,n,i){return t.extend({scoped:i},[e,function(t){return{constructor:function(){t.constructor.call(this),this.__locales=[]},register:function(t){this.__locales.push(t)},_clearLocale:function(){n.iter(this.__locales,function(t){t.clearLocale()},this)},_setLocale:function(e){n.iter(this.__locales,function(t){t.setLocale(e)},this)}}}])}),d.define("module:Classes.ObjectCache",["module:Class","module:Objs"],function(t,e,n){return t.extend({scoped:n},function(n){return{constructor:function(t,e){n.constructor.call(this),this.__keyFunction=t,this.__keyFunctionCtx=e,this.__cache={}},destroy:function(){e.iter(this.__cache,function(t){t.off(null,null,this)},this)},get:function(t){return this.__cache[t]},register:function(t){var e=this.__keyFunction.call(this.__keyFunctionCtx||this,t);return this.__cache[e]&&!this.__cache[e].destroyed()&&this.__cache[e].off(null,null,this),(this.__cache[e]=t).on("destroy",function(){delete this.__cache[e]},this),this}}})}),d.define("module:Classes.ClassRegistry",["module:Class","module:Types","module:Functions","module:Objs"],function(t,i,e,r,n){return t.extend({scoped:n},function(n){return{constructor:function(t,e){n.constructor.call(this),this._classes=i.is_array(t)?t:[t||{}],this._lowercase=e},_sanitize:function(t){return this._lowercase?t.toLowerCase():t},register:function(t,e){return this._classes[this._classes.length-1][this._sanitize(t)]=e,this},get:function(t){if(!i.is_string(t))return t;t=this._sanitize(t);for(var e=this._classes.length-1;0<=e;--e)if(t in this._classes[e])return this._classes[e][t];return null},create:function(t){return e.newClassFunc(this.get(t)).apply(this,e.getArguments(arguments,1))},classes:function(){var e={};return r.iter(this._classes,function(t){e=r.extend(e,t)}),e}}})}),d.define("module:Classes.ContextRegistry",["module:Class","module:Ids","module:Types","module:Objs","module:Iterators.MappedIterator","module:Iterators.ObjectValuesIterator"],function(t,e,o,u,i,r,n){return t.extend({scoped:n},function(n){return{constructor:function(t,e){n.constructor.apply(this),this.__data={},this.__contexts={},this.__serializer=t||this.__defaultSerializer,this.__serializerContext=e||this},__defaultSerializer:function(t){return o.is_object(t)?e.objectId(t):t},_serializeContext:function(t){return t?e.objectId(t):null},_serializeData:function(t){return this.__serializer.call(this.__serializerContext,t)},get:function(t){var e=this._serializeData(t);return this.__data[e]},register:function(t,e){var n=this._serializeData(t),i=this._serializeContext(e),r=!1;return n in this.__data||(this.__data[n]={data:t,contexts:{}},r=!0),i in this.__contexts||(this.__contexts[i]={context:e,datas:{}}),this.__data[n].contexts[i]=!0,this.__contexts[i].datas[n]=!0,r?this.__data[n].data:null},unregister:function(t,e){var n,i,r,s=[];return t?(n=this.__serializer.call(this.__serializerContext,t),this.__data[n]&&(e?(i=this._serializeContext(e),this.__contexts[i]&&(delete this.__contexts[i].datas[n],o.is_empty(this.__contexts[i].datas)&&delete this.__contexts[i]),delete this.__data[n].contexts[i],o.is_empty(this.__data[n].contexts)&&(s.push(this.__data[n].data),delete this.__data[n])):(u.iter(this.__data[n].contexts,function(t,e){this.__contexts[e]&&(delete this.__contexts[e].datas[n],o.is_empty(this.__contexts[e].datas)&&delete this.__contexts[e])},this),s.push(this.__data[n].data),delete this.__data[n]))):e?(r=this._serializeContext(e),this.__contexts[r]&&(u.iter(this.__contexts[r].datas,function(t,e){this.__data[e]&&(delete this.__data[e].contexts[r],o.is_empty(this.__data[e].contexts)&&(s.push(this.__data[e].data),delete this.__data[e]))},this),delete this.__contexts[r])):(u.iter(this.__data,function(t){s.push(t.data)},this),this.__data={},this.__contexts=[]),s},customIterator:function(){return new r(this.__data)},iterator:function(){var t=this.customIterator();return new i(t,function(t){return t.data}).auto_destroy(t,!0)}}})}),d.define("module:Classes.Taggable",["module:Objs"],function(e){return{hasTag:function(t){return this.__tags&&t in this.__tags},getTags:function(){return Object.keys(this.__tags||{})},removeTag:function(t){return this.__tags&&(delete this.__tags[t],this._notify("tags-changed")),this},removeTags:function(t){return e.iter(t,this.removeTag,this),this},addTag:function(t){return this.__tags=this.__tags||{},this.__tags[t]=!0,this._notify("tags-changed"),this},addTags:function(t){return e.iter(t,this.addTag,this),this},tagIntersect:function(t){return e.filter(t,this.hasTag,this)}}}),d.define("module:Classes.StringTable",["module:Class","module:Classes.Taggable","module:Functions","module:Objs"],function(t,e,i,r,n){return t.extend({scoped:n},[e,function(t){return{_notifications:{"tags-changed":function(){this.__cache={}}},constructor:function(){t.constructor.call(this),this.__cache={},this.__strings={}},__resolveKey:function(t,e){return e&&(t=e+"."+t),t=t.replace(/[^\.]+\.</g,"")},__betterMatch:function(t,e){var n=this.tagIntersect(t.tags).length-this.tagIntersect(e.tags).length;return 0!==n||0!==(n=t.priority-e.priority)?0<n:0<(n=e.tags.length-t.tags.length)},register:function(){var n=i.matchArgs(arguments,{strings:!0,prefix:"string",tags:"array",priority:"number"});return r.iter(n.strings,function(t,e){e=this.__resolveKey(e,n.prefix),this.__strings[e]=this.__strings[e]||[],this.__strings[e].push({value:t,tags:n.tags||[],priority:n.priority||0}),delete this.__cache[e]},this),this},get:function(t,e){if((t=this.__resolveKey(t,e))in this.__cache)return this.__cache[t];if(!(t in this.__strings))return null;var n=null;return r.iter(this.__strings[t],function(t){n&&!this.__betterMatch(t,n)||(n=t)},this),this.__cache[t]=n.value,n.value},all:function(){return r.map(this.__strings,function(t,e){return this.get(e)},this)}}}])}),d.define("module:Classes.LocaleTable",["module:Classes.StringTable","module:Classes.LocaleMixin"],function(t,e,n){return t.extend({scoped:n},[e,{_localeTags:function(t){if(!t)return null;var e=[];return e.push("language:"+t),0<t.indexOf("-")&&e.push("language:"+t.substring(0,t.indexOf("-"))),e},_clearLocale:function(){this.removeTags(this._localeTags(this.getLocale()))},_setLocale:function(t){this.addTags(this._localeTags(t))}}])}),d.define("module:Collections.Collection",["module:Class","module:Events.EventsMixin","module:Objs","module:Functions","module:Lists.ArrayList","module:Ids","module:Properties.ObservableMixin","module:Properties.Properties","module:Iterators.ArrayIterator","module:Iterators.MappedIterator","module:Iterators.ConcatIterator","module:Iterators.FilteredIterator","module:Iterators.ObjectValuesIterator","module:Types","module:Promise"],function(u,t,r,s,o,e,n,a,c,_,h,l,d,f,p,i){return u.extend({scoped:i},[t,n,function(i){return{constructor:function(t){i.constructor.call(this),f.is_array(t)&&(t={objects:t}),t=t||{},this.bulk_operations=0,this.__indices={},t.release_references&&(this.__release_references=!0);var e={};"compare"in t&&(e.compare=t.compare),e.get_ident=s.as_method(this.get_ident,this),this.__data=new o([],e);var n=this;this.__data._ident_changed=function(t,e){n._index_changed(t,e)},this.__data._re_indexed=function(t){n._re_indexed(t)},this.__data._sorted=function(){n._sorted()},"objects"in t&&this.add_objects(t.objects),t.indices&&r.iter(t.indices,this.add_secondary_index,this),t.uniqueness&&(this.__uniqueness=t.uniqueness)},get:function(t){switch(t){case"observable_count":return this.count()}return undefined},hasKey:function(t){switch(t){case"observable_count":return!0}return!1},add_secondary_index:function(n){return this.__indices[n]={},this.iterate(function(t){var e=t.get(n);this.__indices[n][e]=this.__indices[n][e]||{},this.__indices[n][e][this.get_ident(t)]=t},this),this},get_by_secondary_index:function(t,e,n){return n?r.ithValue(this.__indices[t][e]):this.__indices[t][e]},get_ident:function(t){return e.objectId(t)},set_compare:function(t){return this.trigger("set_compare",t),this.__data.set_compare(t),this},get_compare:function(){return this.__data.get_compare()},__load_item:function(i){"on"in i&&i.on("change",function(t,e,n){this._object_changed(i,t,e,n)},this),this.__release_references&&i.increaseRef(this)},__unload_item:function(t){"off"in t&&t.off(null,null,this),this.__release_references&&t.decreaseRef(this)},destroy:function(){this.__data.iterate(this.__unload_item,this),this.__data.destroy(),this.trigger("destroy"),i.destroy.call(this)},count:function(){return this.__data.count()},_index_changed:function(t,e){this.trigger("index",t,e)},_re_indexed:function(t){this.trigger("reindexed",t)},_sorted:function(){this.trigger("sorted")},_object_changed:function(t,e,n,i){this.trigger("update"),this.trigger("change",t,e,n,i),this.trigger("change:"+e,t,n,i),this.__data.re_index(this.getIndex(t))},add:function(i){if(u.is_class_instance(i)||(i=new a(i)),this.exists(i))return null;var t=this.__data.add(i);return null!==t&&(r.iter(this.__indices,function(t,e){var n=i.get(e);t[n]=t[n]||{},t[n][this.get_ident(i)]=i},this),this.trigger("add",i),this.trigger("update"),this.trigger("change:observable_count",this.count()),this.__load_item(i)),t},bulkOperationInProgress:function(){return 0<this.bulk_operations},replace_objects:function(t,e){if(this.destroyed())return this;this.bulk_operations++;var s=[],o={};if(r.iter(t,function(t){var e=u.is_class_instance(t),n=e?t:new a(t),i=this.get_ident(n);o[i]=!0;var r=this.getById(i);r?e||(n.destroy(),r.setAll(t)):s.push(n)},this),!e){for(var n=this.iterator();n.hasNext();){var i=n.next();o[this.get_ident(i)]||(this.remove(i),0<s.length&&this.add(s.shift()))}n.destroy()}for(;0<s.length;)this.add(s.shift());return this.bulk_operations--,this.trigger("replaced-objects"),this},add_objects:function(t,e){var n=0;return r.iter(t,function(t){this.add(t)&&n++},this),e?this:n},exists:function(t){return!!this.__data.exists(t)||!!this.__uniqueness&&(this.__indices[this.__uniqueness]?!!this.get_by_secondary_index(this.__uniqueness,t.get(this.__uniqueness),!0):!!this.queryOne(r.objectBy(this.__uniqueness,t.get(this.__uniqueness))))},remove:function(i){if(!this.exists(i))return null;r.iter(this.__indices,function(t,e){var n=i.get(e);t[n]&&(delete t[n][this.get_ident(i)],f.is_empty(t[n])&&delete t[n])},this);var t=this.__data.remove(i);return this.trigger("remove",i),this.trigger("change:observable_count",this.count()),this.__unload_item(i),this.trigger("update"),t},getByIndex:function(t){return this.__data.get(t)},getById:function(t){return this.__data.get(this.__data.ident_by_id(t))},getIndex:function(t){return this.__data.get_ident(t)},iterate:function(t,e){return this.__data.iterate(t,e),this},has:function(e,t){var n=!1;return this.iterate(function(t){n=n||e.call(this,t)},t),n},forall:function(e,t){var n=!0;return this.iterate(function(t){n=n&&e.call(this,t)},t),n},iterator:function(){return c.byIterate(this.iterate,this)},iterateSecondaryIndexValue:function(e,t){return f.is_array(t)?new h(new _(new c(t),function(t){return this.iterateSecondaryIndexValue(e,t)},this)):new d(this.__indices[e][t])},query:function(e){var t=null;for(var n in this.__indices)if(n in e){t=this.iterateSecondaryIndexValue(n,e[n]),delete e[n];break}return new l(t||this.iterator(),function(t){return t.isSupersetOf(e)})},queryOne:function(t){return this.query(t).next()},clear:function(){return this.iterate(function(t){this.remove(t)},this),this},increase_forwards:function(t){return p.error(!0)},increase_backwards:function(t){return p.error(!0)},first:function(){return this.getByIndex(0)},last:function(){return this.getByIndex(this.count()-1)},allSet:function(e,n){return this.iterate(function(t){t.set(e,n)}),this},allSetAll:function(e){return this.iterate(function(t){t.setAll(e)}),this},asJSON:function(){var e=[];return this.iterate(function(t){e.push(t.data())}),e}}}])}),d.define("module:Collections.ConcatCollection",["module:Collections.Collection","module:Objs","module:Functions"],function(t,r,s,e){return t.extend({scoped:e},function(i){return{constructor:function(t,e){this.__parents={},this.__itemToParent={},delete(e=e||{}).objects,e.compare||(e.compare=s.as_method(this.__compareByParent,this)),i.constructor.call(this,e);var n=0;this.__firstParent=null,this.__lastParent=null,r.iter(t,function(e){this.__firstParent||(this.__firstParent=e),this.__lastParent=e,this.__parents[e.cid()]={idx:n,parent:e},e.iterate(function(t){this.__parentAdd(e,t)},this),e.on("add",function(t){this.__parentAdd(e,t)},this),e.on("remove",function(t){this.__parentRemove(e,t)},this),n++},this)},destroy:function(){r.iter(this.__parents,function(t){t.parent.off(null,null,this)},this),i.destroy.call(this)},bulkOperationInProgress:function(){return i.bulkOperationInProgress.call(this)||r.exists(this.__parents,function(t){return t.parent.bulkOperationInProgress()})},increase_forwards:function(t){return this.__lastParent.increase_forwards(t)},increase_backwards:function(t){return this.__firstParent.increase_forwards(t)},__parentAdd:function(t,e){this.__itemToParent[e.cid()]=t,this.add(e)},__parentRemove:function(t,e){delete this.__itemToParent[e.cid()],this.remove(e)},__compareByParent:function(t,e){var n=this.__itemToParent[t.cid()],i=this.__itemToParent[e.cid()];return n===i?n.getIndex(t)-i.getIndex(e):this.__parents[n.cid()].idx-this.__parents[i.cid()].idx}}})}),d.define("module:Collections.FilteredCollection",["module:Collections.Collection"],function(t,e){return t.extend({scoped:e},function(i){return{constructor:function(t,e){this.__parent=t,delete(e=e||{}).objects,e.compare=e.compare||t.get_compare(),i.constructor.call(this,e),this.__parent.on("add",this.add,this),this.__parent.on("remove",this.__selfRemove,this),this.__parent.on("change",this.add,this),this.setFilter(e.filter,e.context)},filter:function(t){return!this.__filter||this.__filter.call(this.__filterContext||this,t)},setFilter:function(t,e){this.__filterContext=e,this.__filter=t,this.iterate(function(t){this.filter(t)||this.__selfRemove(t)},this),this.__parent.iterate(function(t){return!this.exists(t)&&this.filter(t)&&this.__selfAdd(t),!0},this)},_object_changed:function(t,e,n){i._object_changed.call(this,t,e,n),this.filter(t)||this.__selfRemove(t)},destroy:function(){this.__parent.off(null,null,this),i.destroy.call(this)},__selfAdd:function(t){return i.add.call(this,t)},add:function(t){if(this.exists(t)||!this.filter(t))return null;var e=this.__selfAdd(t);return this.__parent.add(t),e},__selfRemove:function(t){return i.remove.call(this,t)},remove:function(t){return this.exists(t)&&this.__selfRemove(t)?this.__parent.remove(t):null}}})}),d.define("module:Collections.GroupedCollection",["module:Collections.Collection","module:Objs","module:Properties.Properties","module:Functions","module:Promise","module:Async"],function(s,i,o,u,t,a,e){return s.extend({scoped:e},function(n){return{constructor:function(t,e){this.__parent=t,delete(e=e||{}).objects,this.__groupby=e.groupby,this.__groupbyCompute=e.groupbyCompute,this.__keepEmptyGroups=e.keepEmptyGroups,this.__autoIncreaseGroups=e.autoIncreaseGroups,this.__generateGroupData=e.generateGroupData,this.__nogaps=!!e.nogaps,this.__lazyNogaps=!!e.lazyNogaps,this.__insertCallback=e.insert,this.__removeCallback=e.remove,this.__afterGroupCreate=e.afterGroupCreate,this.__callbackContext=e.context||this,this.__ignoreParentIncrease=e.ignoreParentIncrease,this.__propertiesClass=e.properties||o,this.__itemsAttribute=e.itemsAttribute||"items",this.__createProperties=e.create,n.constructor.call(this,e),i.iter(this.__groupby,this.add_secondary_index,this),this.__parent.iterate(this.__addParentObject,this),this.__parent.on("add",this.__addParentObject,this),this.__parent.on("remove",this.__removeParentObject,this),this.__objectToGroup={}},destroy:function(){this.__parent.off(null,null,this),n.destroy.call(this)},touchGroup:function(e,t,n){if(!this.destroyed()){if(n)return a.eventually(this.touchGroup,[e,t],this);e=o.is_instance_of(e)?e.data():e,e=this.__groupbyCompute?this.__groupbyCompute.call(this.__callbackContext,e):e;var i={};this.__groupby.forEach(function(t){i[t]=e[t]});var r=this.query(i).nextOrNull();return!r&&t&&((r=this.__createProperties?this.__createProperties.call(this.__callbackContext):new this.__propertiesClass)[this.__itemsAttribute]=r[this.__itemsAttribute]||r.auto_destroy(new s({compare:this.__parent.get_compare()})),r[this.__itemsAttribute].bulkOperationInProgress=u.as_method(this.bulkOperationInProgress,this),r.setAll(e),this.add(r),this.__afterGroupCreate&&this.__afterGroupCreate.call(this.__callbackContext,r),this.trigger("touchgroup",r),this.__nogaps&&(r!==this.last()&&this.touchGroup(this.__generateGroupData.call(this.__callbackContext,r.data(),1),!0,this.__lazyNogaps),r!==this.first()&&this.touchGroup(this.__generateGroupData.call(this.__callbackContext,r.data(),-1),!0,this.__lazyNogaps))),r}},__addParentObject:function(t){var e=this.touchGroup(t,!0);t.cid&&(this.__objectToGroup[t.cid()]=e),this.__addObjectToGroup(t,e)},__removeParentObject:function(t){var e=t.cid&&this.__objectToGroup[t.cid()]?this.__objectToGroup[t.cid()]:this.touchGroup(t);e&&(this.__removeObjectFromGroup(t,e),this.__keepEmptyGroups||0!==e[this.__itemsAttribute].count()||this.remove(e))},__addObjectToGroup:function(t,e){e[this.__itemsAttribute].add(t),this.__insertObject(t,e)},__removeObjectFromGroup:function(t,e){e[this.__itemsAttribute].remove(t),this.__removeObject(t,e)},increase_forwards:function(n){var i=this.__parent.count();return(this.__ignoreParentIncrease?t.create(!0):this.__parent.increase_forwards(n)).success(function(){if(this.__autoIncreaseGroups)for(var t=this.__parent.count()-i,e=this.last();t<n;)e=this.touchGroup(this.__generateGroupData.call(this.__callbackContext,e.data(),1),!0),t++},this)},bulkOperationInProgress:function(){return n.bulkOperationInProgress.call(this)||this.__parent.bulkOperationInProgress()},increase_backwards:function(n){var i=this.__parent.count();return(this.__ignoreParentIncrease?t.create(!0):this.__parent.increase_backwards(n)).success(function(){if(this.__autoIncreaseGroups)for(var t=this.__parent.count()-i,e=this.first();t<n;)e=this.touchGroup(this.__generateGroupData.call(this.__callbackContext,e.data(),-1),!0),t++},this)},__insertObject:function(t,e){this.__insertCallback?this.__insertCallback.call(this.__callbackContext,t,e):e.trigger("insert",t)},__removeObject:function(t,e){this.__removeCallback?this.__removeCallback.call(this.__callbackContext,t,e):e.trigger("remove",t)}}})}),d.define("module:Collections.MappedCollection",["module:Collections.Collection","module:Functions"],function(t,i,e){return t.extend({scoped:e},function(n){return{constructor:function(t,e){this.__parent=t,this.__parentToThis={},this.__thisToParent={},delete(e=e||{}).objects,e.compare=i.as_method(this.__compareByParent,this),n.constructor.call(this,e),this._mapFunction=e.map,this._mapCtx=e.context,t.on("add",this.__parentAdd,this),t.on("remove",this.__parentRemove,this),t.on("change",this.__parentUpdate,this),t.iterate(this.__parentAdd,this)},destroy:function(){this.__parent.off(null,null,this),n.destroy.call(this)},__compareByParent:function(t,e){return this.__parent.getIndex(this.__thisToParent[t.cid()])-this.__parent.getIndex(this.__thisToParent[e.cid()])},__mapItem:function(t,e){return this._mapFunction.call(this._mapCtx||this,t,e)},__parentAdd:function(t){var e=this.__mapItem(t);this.__parentToThis[t.cid()]=e,this.__thisToParent[e.cid()]=t,this.add(e)},__parentUpdate:function(t){this.__mapItem(t,this.__parentToThis[t.cid()])},__parentRemove:function(t){var e=this.__parentToThis[t.cid()];delete this.__parentToThis[t.cid()],delete this.__thisToParent[e.cid()],this.remove(e)}}})}),d.define("module:Exceptions.ErrorCatcher",["module:Class"],function(t,e){return t.extend({scoped:e},function(e){return{constructor:function(t){e.constructor.call(this),this.__thrower=t},throwException:function(t){this.__thrower.throwException(t)}}})}),d.define("module:Exceptions.UncaughtErrorCatcher",["module:Exceptions.ErrorCatcher","module:Functions"],function(t,i,e){return t.extend({scoped:e},function(n){return{constructor:function(t){n.constructor.call(this,t),this.__listenerFunction=i.as_method(this._listenerFunction,this);try{window.addEventListener("error",this.__listenerFunction)}catch(e){}try{process.on("uncaughtException",this.__listenerFunction)}catch(e){}},destroy:function(){try{window.removeEventListener("error",this.__listenerFunction)}catch(t){}try{process.off("uncaughtException",this.__listenerFunction)}catch(t){}n.destroy.call(this)},_listenerFunction:function(t){this.throwException(t)}}})}),d.define("module:Exceptions.ExceptionThrower",["module:Class"],function(t,e){return t.extend({scoped:e},function(t){return{throwException:function(t){return this._throwException(t),this},_throwException:function(t){throw t}}})}),d.define("module:Exceptions.NullExceptionThrower",["module:Exceptions.ExceptionThrower"],function(t,e){return t.extend({scoped:e},function(t){return{_throwException:function(t){}}})}),d.define("module:Exceptions.AsyncExceptionThrower",["module:Exceptions.ExceptionThrower","module:Async"],function(t,e,n){return t.extend({scoped:n},function(t){return{_throwException:function(t){e.eventually(function(){throw t})}}})}),d.define("module:Exceptions.ConsoleExceptionThrower",["module:Exceptions.ExceptionThrower","module:Exceptions.NativeException"],function(t,e,n){return t.extend({scoped:n},function(t){return{_throwException:function(t){console.warn(t.toString())}}})}),d.define("module:Exceptions.EventExceptionThrower",["module:Exceptions.ExceptionThrower","module:Events.EventsMixin"],function(t,e,n){return t.extend({scoped:n},[e,function(t){return{_throwException:function(t){this.trigger("exception",t)}}}])}),d.define("module:Exceptions.Exception",["module:Class","module:Comparators"],function(t,e,n){return t.extend({scoped:n},function(n){return{constructor:function(t){n.constructor.call(this),this.__message=t;try{throw new Error}catch(e){this.__stack=e.stack}},assert:function(t){if(!this.instance_of(t))throw this;return this},message:function(){return this.__message},stack:function(){return this.__stack},toString:function(){return this.message()},format:function(){return this.cls.classname+": "+this.toString()},json:function(){return{classname:this.cls.classname,message:this.message(),stack:this.stack()}},equals:function(t){return t&&this.cls===t.cls&&e.deepEqual(this.json(),t.json(),-1)}}},{ensure:function(t){if(!this.is_instance_of(t))throw"Unasserted Exception "+t;return t}})}),d.define("module:Exceptions.NativeException",["module:Types","module:Objs","module:Exceptions.Exception"],function(t,i,e,n){var r=e.extend({scoped:n},function(n){return{constructor:function(e){this.__data={},e&&["name","message","filename","lineno"].forEach(function(t){t in e&&(this.__data[t]=e[t])},this),n.constructor.call(this,e?i.values(this.__data).join("; "):"null"),this.__object=e},object:function(){return this.__object},data:function(){return this.__data},json:function(){var t=n.json.call(this);return t.data=this.data(),t}}},{ensure:function(t){return r.is_instance_of(t)?t:new r(t)}});return r}),d.define("module:Async",["module:Types","module:Functions","module:Time"],function(t,r,s){var i=function(t){return clearTimeout(t)},o=r.global_method("clearImmediate")||r.global_method("cancelAnimationFrame")||r.global_method("webkitCancelAnimationFrame")||r.global_method("mozCancelAnimationFrame")||i,u=r.global_method("setImmediate")||r.global_method("requestAnimationFrame")||r.global_method("webkitRequestAnimationFrame")||r.global_method("mozRequestAnimationFrame")||function(t){return setTimeout(t,0)},a={},c=1,e={waitFor:function(){var e=r.matchArgs(arguments,{condition:!0,conditionCtx:"object",callback:!0,callbackCtx:"object",interval:"number",timeoutCallback:"function",timeoutCallbackCtx:"object",timeout:"number"}),t=function(){try{return!!e.condition.apply(e.conditionCtx||e.callbackCtx||this)}catch(t){return!1}},n=s.now();if(!t()){var i=setInterval(function(){t()?(clearInterval(i),e.callback.apply(e.callbackCtx||this)):e.timeout&&s.now()-n>=e.timeout&&(clearInterval(i),e.timeoutCallback&&e.timeoutCallback.apply(e.timeoutCallbackCtx||e.callbackCtx||this))},e.interval||1);return i}e.callback.apply(e.callbackCtx||this)},asyncify:function(t){return function(){e.eventually(t,this)}},eventually:function(){var t=r.matchArgs(arguments,{func:!0,params:"array",context:"object",time:"number"});t.time=t.time||0;var e={},n=function(){e.clear(e.handle),t.func.apply(t.context||this,t.params||[])};return 0<t.time?(e.clear=i,e.handle=setTimeout(n,t.time)):(e.clear=o,e.handle=u(n)),e},clearEventually:function(t){t&&t.clear&&t.handle&&t.clear(t.handle)},eventuallyOnce:function(t,e,n){var i={func:t,params:e,context:n};for(var r in a){var s=a[r];if(s.func===t&&s.params===e&&s.context===n)return}var o=++c;return a[o]=i,this.eventually(function(){delete a[o],t.apply(n||this,e||[])},this)}};return e}),d.define("module:Promise",["module:Types","module:Functions","module:Async","module:Objs"],function(r,u,a,t){var c={Promise:function(t,e,n){this.__value=e||t===undefined?null:t,this.__error=e||null,this.__isFinished=n,this.__hasError=!!e,this.__resultPromise=null,this.__callbacks=[]},fromNativePromise:function(t){var e=this.create();return t.then(function(t){e.asyncSuccess(t)})["catch"](function(t){e.asyncError(t)}),e},create:function(t,e){return new this.Promise(t,e,0<arguments.length)},value:function(t){return this.is(t)?t:new this.Promise(t,null,!0)},eventualValue:function(t){var e=new this.Promise;return a.eventually(function(){e.asyncSuccess(t)}),e},error:function(t){return this.is(t)?t:new this.Promise(null,t,!0)},box:function(t,e,n){if(t&&"then"in t&&"catch"in t){var i=this.create();return t.then(i.asyncSuccessFunc()),t["catch"](i.asyncErrorFunc()),i}try{var r=t.apply(e||this,n||[]);return this.is(r)?r:this.value(r)}catch(s){return this.error(s)}},tryCatch:function(t,e){try{return this.value(t.apply(e||this))}catch(n){return this.error(n)}},funcCallback:function(t,e){var n=[];r.is_function(t)?(n=u.getArguments(arguments,1),e=t,t=this):n=u.getArguments(arguments,2);var i=this.create();return n.push(i.asyncCallbackFunc()),e.apply(t,n),i},and:function(t){var e=this.create();return e.__promises=[],e.__successCount=0,e.__values=[],e.__errorPromise=null,e.and=function(t){if(t=t||[],this.__ended)return this;r.is_array(t)||(t=[t]);for(var e=function(t,e){t?this.promise.__errorPromise=this.promise.__promises[this.idx]:(this.promise.__successCount++,this.promise.__values[this.idx]=e),this.promise.results()},n=0;n<t.length;++n){var i=this.__promises.length;this.__promises.push(t[n]),this.__values.push(null),t[n].isFinished()?t[n].hasValue()?(this.__successCount++,this.__values[i]=t[n].value()):this.__errorPromise=t[n]:t[n].callback(e,{promise:this,idx:i})}return this},e.end=function(){return this.__ended||(this.__ended=!0,this.results()),this},e.results=function(){return this.__ended&&this.__errorPromise?this.asyncError(this.__errorPromise.err(),this.__errorPromise):this.__ended&&this.__successCount==this.__promises.length&&this.asyncSuccess(this.__values),this},e.successUnfold=function(t,e,n){return this.success(function(){return t.apply(e,arguments)},e,n)},e.and(t),e},func:function(r){for(var s=u.getArguments(arguments,1),t=[],e=0;e<s.length;++e)this.is(s[e])&&t.push(s[e]);var o=this.create();return this.and(t).end().success(function(t){for(var e=[],n=0;n<s.length;++n)e[n]=this.is(s[n])?s[n].value():s[n];var i=r.apply(this,e);this.is(i)?i.forwardCallback(o):o.asyncSuccess(i)},this).forwardError(o),o},methodArgs:function(t,e,n){return n.unshift(function(){return e.apply(t,arguments)}),this.func.apply(this,n)},method:function(t,e){return this.methodArgs(t,e,u.getArguments(arguments,2))},newClass:function(t){var e=u.getArguments(arguments,1);return e.unshift(u.newClassFunc(t)),this.func.apply(this,e)},is:function(t){return t&&r.is_object(t)&&t.classGuid==this.Promise.prototype.classGuid},resilience:function(e,n,i,r,t){return t&&(e=this.delayPromiseMethod(e,t)),e.apply(n,r).mapError(function(t){return 0===i?t:this.resilience(e,n,i-1,r)},this)},delayPromiseMethod:function(n,i){var r=this;return function(){var t=r.create(),e=u.getArguments(arguments);return a.eventually(function(){n.apply(this,e).forwardCallback(t)},this,i),t}},waitFor:function(t,e,n,i){var r,s,o=this.create();return i&&(s=setTimeout(function(){r&&clearInterval(r),o.asyncError(!0)},i)),r=a.waitFor(t,e,function(){s&&clearTimeout(s),o.asyncSuccess(!0)},n),o},exclusiveExecution:function(i,r){var s=null,o=[];return function(){var t,e=arguments,n=null;return(n=s?(t=c.create(),o.push(t),t.mapSuccess(function(){return i.apply(this,e)},r)):s=i.apply(r,e)).callback(function(){s=null,0<o.length&&(s=o.shift()).asyncSuccess(!0)}),n}}};return t.extend(c.Promise.prototype,{classGuid:"7e3ed52f-22da-4e9c-95a4-e9bb877a3935",success:function(t,e,n){return this.callback(t,e,n,"success")},asuccess:function(t,e,n){return this.success(a.asyncify(t),e,n)},valueify:function(e,n){return this.success(function(t){e[n]=t})},error:function(t,e,n){return this.callback(t,e,n,"error")},callback:function(t,e,n,i){"end"in this&&this.end();var r={type:i||"callback",func:t,options:n||{},context:e};return this.__isFinished?this.triggerResult(r):this.__callbacks.push(r),this},timeout:function(t,e,n){var i=a.eventually(e,n,t);return this.callback(function(){a.clearEventually(i)})},timeoutError:function(t,e){return t?this.timeout(t,function(){this.asyncError(e)},this):this},triggerResult:function(t){if(!this.__isFinished)return this;if(t)"success"!=t.type||this.__hasError?"error"==t.type&&this.__hasError?t.func.call(t.context||this,this.__error,this.__resultPromise||this):"callback"==t.type&&t.func.call(t.context||this,this.__error,this.__value,this.__resultPromise||this):t.func.call(t.context||this,this.__value,this.__resultPromise||this);else{var e=this.__callbacks;this.__callbacks=[];for(var n=0;n<e.length;++n)this.triggerResult(e[n])}return this},value:function(){return this.__value},err:function(){return this.__error},isFinished:function(){return this.__isFinished},hasValue:function(){return this.__isFinished&&!this.__hasError},hasError:function(){return this.__isFinished&&this.__hasError},asyncSuccess:function(t,e){return this.__isFinished?this:(this.__resultPromise=e,this.__error=null,this.__isFinished=!0,this.__hasError=!1,this.__value=t,this.triggerResult())},asyncError:function(t,e){return this.__isFinished?this:(this.__resultPromise=e,this.__isFinished=!0,this.__hasError=!0,this.__error=t,this.__value=null,this.triggerResult())},asyncCallback:function(t,e,n){return t?this.asyncError(t,n):this.asyncSuccess(e,n)},forwardSuccess:function(t){return this.success(t.asyncSuccess,t),this},forwardError:function(t){return this.error(t.asyncError,t),this},forwardCallback:function(t){return this.callback(t.asyncCallback,t),this},asyncCallbackFunc:function(){return u.as_method(this.asyncCallback,this)},asyncSuccessFunc:function(){return u.as_method(this.asyncSuccess,this)},asyncErrorFunc:function(){return u.as_method(this.asyncError,this)},mapSuccess:function(r,s){var o=c.create();return this.forwardError(o).success(function(t,e){try{var n=r.call(s||o,t,e);c.is(n)?n.forwardCallback(o):o.asyncSuccess(n)}catch(i){this.__callbacks.every(function(t){return"success"===t.type})&&console.warn(i),o.asyncError(i)}}),o},mapASuccess:function(n,i){return this.mapSuccess(function(t){var e=c.create();return a.eventually(function(){c.box(n,i,[t]).forwardCallback(e)}),e})},mapError:function(i,r){var s=c.create();return this.forwardSuccess(s).error(function(t,e){var n=i.call(r||s,t,e);c.is(n)?n.forwardCallback(s):s.asyncError(n)}),s},mapCallback:function(r,s){var o=c.create();return this.callback(function(t,e,n){var i=r.call(s||o,t,e,n);c.is(i)?i.forwardCallback(o):o.asyncCallback(t?i:t,t?e:i,n)}),o},and:function(t){return c.and(this).and(t)}}),c}),d.define("module:Timers.Timer",["module:Class","module:Objs","module:Time"],function(t,n,i,e){return t.extend({scoped:e},function(e){return{constructor:function(t){e.constructor.call(this),t=n.extend({once:!1,start:!0,fire:null,context:this,destroy_on_fire:!1,destroy_on_stop:!1,real_time:!1,duration:null,fire_max:null,immediate:!1},t),this.__immediate=t.immediate,this.__delay=t.delay,this.__destroy_on_fire=t.destroy_on_fire,this.__destroy_on_stop=t.destroy_on_stop,this.__once=t.once,this.__fire=t.fire,this.__context=t.context,this.__started=!1,this.__real_time=t.real_time,this.__end_time=null!==t.duration?i.now()+t.duration:null,this.__fire_max=t.fire_max,t.start&&this.start()},destroy:function(){this.stop(),e.destroy.call(this)},fire_count:function(){return this.__fire_count},duration:function(){return i.now()-this.__start_time},fire:function(){if(this.__once&&(this.__started=!1),this.__fire&&(this.__fire.call(this.__context,this),this.__fire_count++,this.__real_time&&!this.__destroy_on_fire&&!this.__once))for(;(this.__fire_count+1)*this.__delay<=i.now()-this.__start_time;)this.__fire.call(this.__context,this),this.__fire_count++;(null!==this.__end_time&&i.now()+this.__delay>this.__end_time||null!==this.__fire_max&&this.__fire_max<=this.__fire_count)&&this.stop(),this.__destroy_on_fire&&this.weakDestroy()},stop:function(){return this.__started&&((this.__once?clearTimeout:clearInterval)(this.__timer),this.__started=!1,this.__destroy_on_stop&&this.weakDestroy()),this},start:function(){if(this.__started)return this;var t=this;return this.__start_time=i.now(),this.__fire_count=0,this.__once?this.__timer=setTimeout(function(){t.fire()},this.__delay):this.__timer=setInterval(function(){t.fire()},this.__delay),this.__started=!0,this.__immediate&&this.fire(),this},restart:function(){return this.stop(),this.start(),this}}})}),d.define("module:Iterators.ArrayIterator",["module:Iterators.Iterator"],function(t,e){return t.extend({scoped:e},function(e){return{constructor:function(t){e.constructor.call(this),this.__array=t,this.__i=0},hasNext:function(){return this.__i<this.__array.length},next:function(){var t=this.__array[this.__i];return this.__i++,t}}},{byIterate:function(t,e){var n=[];return t.call(e||this,function(t){n.push(t)},this),new this(n)}})}),d.define("module:Iterators.NativeMapIterator",["module:Iterators.Iterator"],function(t,e){return t.extend({scoped:e},function(e){return{constructor:function(t){e.constructor.call(this),this.__iter=t.values(),this.__next=this.__iter.next()},hasNext:function(){return!this.__next.done},next:function(){var t=this.__next.value;return this.__next=this.__iter.next(),t}}})}),d.define("module:Iterators.ObjectKeysIterator",["module:Iterators.ArrayIterator"],function(t,e){return t.extend({scoped:e},function(e){return{constructor:function(t){e.constructor.call(this,Object.keys(t))}}})}),d.define("module:Iterators.ObjectValuesIterator",["module:Iterators.ArrayIterator","module:Objs"],function(t,n,e){return t.extend({scoped:e},function(e){return{constructor:function(t){e.constructor.call(this,n.values(t))}}})}),d.define("module:Iterators.LazyMultiArrayIterator",["module:Iterators.LazyIterator"],function(t,e){return t.extend({scoped:e},function(n){return{constructor:function(t,e){n.constructor.call(this),this.__next_callback=t,this.__next_context=e,this.__array=null,this.__i=0},_next:function(){if((null===this.__array||this.__i>=this.__array.length)&&(this.__array=this.__next_callback.apply(this.__next_context),this.__i=0),null!==this.__array){var t=this.__array[this.__i];return this.__i++,t}this._finished()}}})}),d.define("module:Iterators.MappedIterator",["module:Iterators.Iterator"],function(t,e){return t.extend({scoped:e},function(i){return{constructor:function(t,e,n){i.constructor.call(this),this.__iterator=t,this.__map=e,this.__context=n||this},hasNext:function(){return this.__iterator.hasNext()},next:function(){return this.hasNext()?this.__map.call(this.__context,this.__iterator.next()):null}}})}),d.define("module:Iterators.FilteredIterator",["module:Iterators.Iterator"],function(t,e){return t.extend({scoped:e},function(i){return{constructor:function(t,e,n){i.constructor.call(this),this.__iterator=t,this.__filter=e,this.__context=n||this,this.__next=null},hasNext:function(){return this.__crawl(),null!==this.__next},next:function(){this.__crawl();var t=this.__next;return this.__next=null,t},__crawl:function(){for(;!this.__next&&this.__iterator.hasNext();){var t=this.__iterator.next();this.__filter_func(t)&&(this.__next=t)}},__filter_func:function(t){return this.__filter.apply(this.__context,[t])}}})}),d.define("module:Iterators.SkipIterator",["module:Iterators.Iterator"],function(t,e){return t.extend({scoped:e},function(n){return{constructor:function(t,e){for(n.constructor.call(this),this.__iterator=t;0<e;)t.next(),e--},hasNext:function(){return this.__iterator.hasNext()},next:function(){return this.__iterator.next()}}})}),d.define("module:Iterators.LimitIterator",["module:Iterators.Iterator"],function(t,e){return t.extend({scoped:e},function(n){return{constructor:function(t,e){n.constructor.call(this),this.__iterator=t,this.__limit=e},hasNext:function(){return 0<this.__limit&&this.__iterator.hasNext()},next:function(){return this.__limit<=0?null:(this.__limit--,this.__iterator.next())}}})}),d.define("module:Iterators.SortedIterator",["module:Iterators.Iterator"],function(t,e){return t.extend({scoped:e},function(n){return{constructor:function(t,e){n.constructor.call(this),this.__array=t.asArray(),this.__array.sort(e),this.__i=0},hasNext:function(){return this.__i<this.__array.length},next:function(){var t=this.__array[this.__i];return this.__i++,t}}})}),d.define("module:Iterators.LazyIterator",["module:Iterators.Iterator"],function(t,e){return t.extend({scoped:e},function(t){return{constructor:function(){t.constructor.call(this),this.__finished=!1,this.__initialized=!1,this.__current=null,this.__has_current=!1},_initialize:function(){},_next:function(){},_finished:function(){this.__finished=!0},_current:function(t){this.__current=t,this.__has_current=!0},__touch:function(){this.__initialized||this._initialize(),this.__initialized=!0,this.__has_current||this.__finished||this._next()},hasNext:function(){return this.__touch(),this.__has_current},next:function(){return this.__touch(),this.__has_current=!1,this.__current}}})}),d.define("module:Iterators.SortedOrIterator",["module:Iterators.LazyIterator","module:Structures.TreeMap","module:Objs"],function(t,i,e,n){return t.extend({scoped:n},function(n){return{constructor:function(t,e){this.__iterators=t,this.__map=i.empty(e),n.constructor.call(this)},__process:function(t){var e,n;t.hasNext()&&(e=t.next(),(n=i.find(e,this.__map))?n.push(t):this.__map=i.add(e,[t],this.__map))},_initialize:function(){e.iter(this.__iterators,this.__process,this),i.is_empty(this.__map)&&this._finished()},_next:function(){var t=i.take_min(this.__map);this._current(t[0].key),this.__map=t[1],e.iter(t[0].value,this.__process,this),i.is_empty(this.__map)&&this._finished()}}})}),d.define("module:Iterators.PartiallySortedIterator",["module:Iterators.Iterator"],function(t,e){return t.extend({scoped:e},function(i){return{constructor:function(t,e,n){i.constructor.call(this),this.__compare=e,this.__partial_same=n,this.__iterator=t,this.__head=[],this.__tail=[]},__cache:function(){if(!(0<this.__head.length)&&(this.__head=this.__tail,this.__tail=[],this.__iterator.hasNext())){for(0===this.__head.length&&this.__head.push(this.__iterator.next());this.__iterator.hasNext();){var t=this.__iterator.next();if(!this.__partial_same(this.__head[0],t)){this.__tail.push(t);break}this.__head.push(t)}this.__head.sort(this.__compare)}},hasNext:function(){return this.__cache(),0<this.__head.length},next:function(){return this.__cache(),this.__head.shift()}}})}),d.define("module:Iterators.ConcatIterator",["module:Iterators.Iterator"],function(t,e){return t.extend({scoped:e},function(e){return{constructor:function(t){e.constructor.call(this),this.__iterators=t,this.__current=null},__ensure:function(){for(;(!this.__current||!this.__current.hasNext())&&this.__iterators.hasNext();)this.__current=this.__iterators.next();return this.__current},hasNext:function(){var t=this.__ensure();return t&&t.hasNext()},next:function(){return this.__ensure().next()}}})}),d.extend("module:Iterators",["module:Types","module:Iterators.Iterator","module:Iterators.ArrayIterator"],function(e,n,i){return{ensure:function(t){return null===t?new i([]):t.instance_of(n)?t:e.is_array(t)?new i(t):new i([t])}}}),d.define("module:Iterators.Iterator",["module:Class","module:Functions","module:Async","module:Promise"],function(t,e,r,s,n){return t.extend({scoped:n},function(t){return{hasNext:function(){return!1},next:function(){return null},nextOrNull:function(){return this.hasNext()?this.next():null},asArray:function(t){for(var e=[];this.hasNext();)e.push(this.next());return t||this.weakDestroy(),e},iterate:function(t,e,n){for(;this.hasNext();){if(!1===t.call(e||this,this.next()))break}n||this.weakDestroy()},asyncIterate:function(t,e,n){if(!this.hasNext())return this.destroy(),s.value(!0);if(!1===t.call(e||this,this.next()))return s.value(!0);var i=s.create();return r.eventually(function(){this.asyncIterate(t,e,n).forwardCallback(i)},this,n),i}}})}),d.define("module:Loggers.CallOriginLogAugment",["module:Loggers.AbstractLogAugment","module:Functions"],function(t,i,e){return t.extend({scoped:e},function(t){return{augmentMessage:function(t,e,n){return i.getStackTrace(3*n+6)[0].trim()}}})}),d.define("module:Loggers.ConsoleLogListener",["module:Loggers.LogListener"],function(t,e){return t.extend({scoped:e},function(e){return{constructor:function(t){e.constructor.call(this),this._options=t||{}},message:function(t,e){var n=e.args.concat(e.augments);this._options.single&&(n=[n.join(" | ")]),console[e.type].apply(console,n)}}})}),d.define("module:Loggers.AbstractLogAugment",["module:Class"],function(t,e){return t.extend({scoped:e},function(t){return{augmentMessage:function(t,e,n){}}})}),d.define("module:Loggers.LogListenerFilter",["module:Loggers.LogListener","module:Objs","module:Types"],function(t,i,r,e){return t.extend({scoped:e},function(n){return{constructor:function(t,e){n.constructor.call(this),this.__target=t,this.__tags=e},message:function(t,e){var n=i.objectify(e.tags);(r.is_array(this.__tags[0])?this.__tags.some(function(t){return t.every(function(t){return n[t]})}):this.__tags.every(function(t){return n[t]}))&&this.__target.message(t,e)}}})}),d.define("module:Loggers.LogListener",["module:Class"],function(t,e){return t.extend({scoped:e},function(t){return{message:function(t,e){}}})}),d.define("module:Loggers.LoggableMixin",["module:Loggers.Logger","module:Objs","module:Functions"],function(t){return{baseLogger:function(){return this._baseLogger||(this._baseLogger=t.global()),this._baseLogger},logger:function(){return this._logger||(this._logger=this.baseLogger().tag(this.cls.classname,this.cid())),this._logger}}}),d.define("module:Loggers.Logger",["module:Class","module:Objs","module:Functions"],function(t,r,n,e){var i=t.extend({scoped:e},function(e){return{constructor:function(t){e.constructor.call(this),t=t||{},this.__listeners={},this.__augments={},this.__tags=t.tags||[],r.iter(t.listeners,this.addListener,this)},addAugment:function(t,e){return this.__augments[t.cid()]={augment:t,prefix:e},this},removeAugment:function(t){return delete this.__augments[t.cid()],this},addListener:function(t){return this.__listeners[t.cid()]=t,this},removeListener:function(t){return delete this.__listeners[t.cid()],this},log:function(){return this.message(this,{type:"log",args:n.getArguments(arguments,0)})},logf:function(){return n.as_method(this.log,this)},warn:function(){return this.message(this,{type:"warn",args:n.getArguments(arguments,0)})},error:function(){return this.message(this,{type:"error",args:n.getArguments(arguments,0)})},taggedlog:function(t){return this.message(this,{type:"log",tags:t,args:n.getArguments(arguments,1)})},taggedwarn:function(t){return this.message(this,{type:"warn",tags:t,args:n.getArguments(arguments,1)})},taggederror:function(t){return this.message(this,{type:"error",tags:t,args:n.getArguments(arguments,1)})},message:function(e,n,i){return i=i||0,n.tags=this.__tags.concat(n.tags||[]),n.augments=n.augments||[],r.iter(this.__augments,function(t){n.augments.push((t.prefix?t.prefix+":":"")+t.augment.augmentMessage(e,n,i))},this),r.iter(this.__listeners,function(t){t.message(this,n,i+1)},this),this},tag:function(){return new i({tags:n.getArguments(arguments),listeners:[this]})}}},{global:function(){return this.__global||(this.__global=new i),this.__global}});return i}),d.define("module:Loggers.StaticLogAugment",["module:Loggers.AbstractLogAugment"],function(t,e){return t.extend({scoped:e},function(e){return{constructor:function(t){e.constructor.call(this),this.__value=t},getValue:function(){return this.__value},setValue:function(t){return this.__value=t,this},augmentMessage:function(t,e,n){return this.__value}}})}),d.define("module:Loggers.TagLogAugment",["module:Loggers.AbstractLogAugment"],function(t,e){return t.extend({scoped:e},function(t){return{augmentMessage:function(t,e,n){return e.tags.join(",")}}})}),d.define("module:Loggers.TimeLogAugment",["module:Loggers.AbstractLogAugment","module:Time","module:TimeFormat"],function(t,s,o,e){return t.extend({scoped:e},function(e){return{constructor:function(t){e.constructor.call(this),this._options=t||{},this.__last=s.now()},augmentMessage:function(t,e,n){var i=s.now(),r=i-this.__last;return this.__last=i,(this._options.time_format?o.format(this._options.time_format,i):i)+(this._options.delta?" (+"+r+"ms)":"")}}})}),d.define("module:Net.SocketSenderChannel",["module:Channels.Sender"],function(t,e){return t.extend({scoped:e},function(n){return{constructor:function(t,e){n.constructor.call(this),this.__socket=t,this.__message=e},_send:function(t,e){this.__socket.emit(this.__message,{message:t,data:e})},socket:function(){return 0<arguments.length&&(this.__socket=arguments[0]),this.__socket}}})}),d.define("module:Net.SocketReceiverChannel",["module:Channels.Receiver"],function(t,e){return t.extend({scoped:e},function(n){return{constructor:function(t,e){n.constructor.call(this),this.__message=e,this.socket(t)},socket:function(){var e;return 0<arguments.length&&(this.__socket=arguments[0],this.__socket&&(e=this).__socket.on(this.__message,function(t){e._receive(t.message,t.data)})),this.__socket}}})}),d.define("module:Net.Cookies",["module:Objs","module:Types"],function(a,c){return{getCookielikeValue:function(t,e){return t=t||"",decodeURIComponent(t.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},createCookielikeValue:function(t,e,n,i,r,s,o){if(!t||/^(?:expires|max\-age|path|domain|secure)$/i.test(t))return null;var u=[];return u.push([encodeURIComponent(t),encodeURIComponent(e)]),n&&(n===Infinity?u.push(["expires","Fri, 31 Dec 9999 23:59:59 GMT"]):"number"==typeof n?u.push(["max-age",n]):"object"==typeof n?u.push(["expires",n.toUTCString()]):u.push(["expires",n])),r&&u.push(["domain",r]),i&&u.push(["path",i]),s&&u.push("secure"),o=o||"None",u.push("SameSite",o),a.map(u,function(t){return c.is_array(t)?t.join("="):t}).join("; ")},removeCookielikeValue:function(t,e,n,i){return this.createCookielikeValue(t,e,new Date(0),n,i)},hasCookielikeValue:function(t,e){return new RegExp("(?:^|;\\s*)"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(t)},keysCookielike:function(t){var e=t.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/);return a.map(e,decodeURIComponent)}}}),d.define("module:Net.HttpHeader",function(){return{HTTP_STATUS_OK:200,HTTP_STATUS_CREATED:201,HTTP_STATUS_BAD_REQUEST:400,HTTP_STATUS_UNAUTHORIZED:401,HTTP_STATUS_PAYMENT_REQUIRED:402,HTTP_STATUS_FORBIDDEN:403,HTTP_STATUS_NOT_FOUND:404,HTTP_STATUS_PRECONDITION_FAILED:412,HTTP_STATUS_INTERNAL_SERVER_ERROR:500,HTTP_STATUS_GATEWAY_TIMEOUT:504,STRINGS:{0:"Unknown Error",200:"OK",201:"Created",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not found",412:"Precondition Failed",500:"Internal Server Error",504:"Gateway timeout"},format:function(t,e){var n=this.STRINGS[t in this.STRINGS?t:0];return e?t+" "+n:n},isSuccessStatus:function(t){return t>=this.HTTP_STATUS_OK&&t<300}}}),d.define("module:Net.Uri",["module:Objs","module:Types","module:Strings","module:Sort"],function(r,s,i,n){var o=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,u=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,a=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],c=/(?:^|&)([^&=]*)=?([^&]*)/g;return{build:function(t){var e="";return t.protocol&&(e+=t.protocol+"://"),t.username&&(e+=t.username+":"),t.password&&(e+=t.password+"@"),e+=t.server,t.port&&(e+=":"+t.port),t.path&&(e+="/"+t.path),e},encodeUriParams:function(t,n,e){n=n||"";var i=[];return e?r.iter(r.serializeFlatJSON(t),function(t){i.push(n+t.key+"="+encodeURIComponent(t.value))},this):r.iter(t,function(t,e){s.is_object(t)?i=i.concat(this.encodeUriParams(t,n+e+"_")):i.push(n+e+"="+encodeURIComponent(t))},this),i.join("&")},decodeUriParams:function(t){var n={};return t.split("&").forEach(function(t){var e=i.splitFirst(t,"=");n[e.head]=decodeURIComponent(e.tail)}),n},appendUriParams:function(t,e,n){return s.is_empty(e)?t:t+(-1!=t.indexOf("?")?"&":"?")+this.encodeUriParams(e,n)},parse:function(t,e){for(var n=(e?o:u).exec(t),i={},r=0;r<a.length;++r)i[a[r]]=n[r]||"";return i.queryKey={},i[a[12]].replace(c,function(t,e,n){e&&(i.queryKey[e]=n)}),i},isCrossDomainUri:function(t,e){return!(e.indexOf("//")<0)&&(t.indexOf("//")<0||(t=this.parse(t.toLowerCase()),e=this.parse(e.toLowerCase()),"file"===t.protocol||"file"===e.protocol?t.protocol===e.protocol:t.host!==e.host||t.port!==e.port))},normalizeUri:function(t){var e=t.indexOf("?");return 0<=e?t.substring(0,e)+"?"+this.encodeUriParams(n.sort_object(this.decodeUriParams(t.substring(e+1)),function(t,e){return t.localeCompare(e)})):t}}}),d.define("module:RMI.Client",["module:Class","module:Objs","module:Channels.TransportChannel","module:Ids","module:RMI.Skeleton","module:Types","module:RMI.Stub"],function(t,s,r,n,e,o,u,i){return t.extend({scoped:i},function(i){return{constructor:function(t,e){var n;i.constructor.call(this),this.__channel=null,this.__instances={},t&&(n=t,e&&(n=this._auto_destroy(new r(t,e))),this.__channel=n)},destroy:function(){this.__channel&&this.disconnect(),i.destroy.call(this)},connect:function(t){if(!this.__channel)return this.__channel=t,this},connectTransport:function(t,e,n){return this.connect(this.auto_destroy(new r(t,e,n)))},disconnect:function(){if(this.__channel)return this.__channel=null,s.iter(this.__instances,function(t){this.release(t)},this),this},_serializeValue:function(t){return e.is_instance_of(t)?(this.server.registerInstance(t),{__rmi_meta:!0,__rmi_stub:t.stub(),__rmi_stub_id:n.objectId(t)}):t},_unserializeValue:function(t){if(t&&t.__rmi_meta){return this.acquire(t.__rmi_stub,t.__rmi_stub_id)}return t},acquire:function(t,i){if(this.__instances[i])return this.__instances[i];if(o.is_string(t)&&(t=d.getGlobal(t)),!t||!t.ancestor_of(u))return null;var e=new t;this.__instances[n.objectId(e,i)]=e;var r=this;return e.__send=function(t,e,n){if(r.__channel)return e=s.map(e,r._serializeValue,r),r.__channel.send(i+":"+t,e,{serializerInfo:n}).mapSuccess(function(t){return this._unserializeValue(t)},r)},e},release:function(t){var e=n.objectId(t);return this.__instances[e]&&(t.weakDestroy(),delete this.__instances[e]),this}}})}),d.define("module:RMI.Peer",["module:Class","module:Channels.SenderMultiplexer","module:Channels.ReceiverMultiplexer","module:RMI.Client","module:RMI.Server"],function(t,i,r,s,o,e){return t.extend({scoped:e},function(n){return{constructor:function(t,e){n.constructor.call(this),this.__sender=t,this.__receiver=e,this.__client_sender=this._auto_destroy(new i(t,"client")),this.__server_sender=this._auto_destroy(new i(t,"server")),this.__client_receiver=this._auto_destroy(new r(e,"server")),this.__server_receiver=this._auto_destroy(new r(e,"client")),this.client=this._auto_destroy(new s(this.__client_sender,this.__client_receiver)),this.server=this._auto_destroy(new o(this.__server_sender,this.__server_receiver)),this.client.server=this.server,this.server.client=this.client},acquire:function(t,e){return this.client.acquire(t,e)},release:function(t){this.client.release(t)},registerInstance:function(t,e){return this.server.registerInstance(t,e)},unregisterInstance:function(t){this.server.unregisterInstance(t)}}})}),d.define("module:RMI.Server",["module:Class","module:Events.EventsMixin","module:Objs","module:Channels.TransportChannel","module:Lists.ObjectIdList","module:Ids","module:RMI.Skeleton","module:Promise"],function(t,e,s,r,o,n,u,a,i){return t.extend({scoped:i},[e,function(i){return{constructor:function(t,e){var n;i.constructor.call(this),this.__channels=new o,this.__instances={},t&&(n=t,e&&(n=this._auto_destroy(new r(t,e))),this.registerClient(n))},destroy:function(){this.__channels.iterate(this.unregisterClient,this),s.iter(this.__instances,function(t){this.unregisterInstance(t.instance)},this),this.__channels.destroy(),i.destroy.call(this)},registerInstance:function(t,e){return e=e||{},this.__instances[n.objectId(t,e.name)]={instance:t,options:e},e.auto_destroy&&this.auto_destroy(t),t},unregisterInstance:function(t){return delete this.__instances[n.objectId(t)],t.weakDestroy(),this},registerClient:function(i,t){t=t||{};var r=this;return this.__channels.add(i),i._reply=function(t,e){var n=t.split(":");return 2==n.length?r._invoke(i,n[0],n[1],e):a.error(!0)},t.auto_destroy&&this.auto_destroy(i),this},registerTransportClient:function(t,e,n){return this.registerClient(this.auto_destroy(new r(t,e,n)))},unregisterClient:function(t){return this.__channels.remove(t),t._reply=null,this},_serializeValue:function(t){if(u.is_instance_of(t)){return this.registerInstance(t),{__rmi_meta:!0,__rmi_stub:t.stub(),__rmi_stub_id:n.objectId(t)}}return t},_unserializeValue:function(t){return t&&t.__rmi_meta?this.client.acquire(t.__rmi_stub,t.__rmi_stub_id):t},_invoke:function(t,e,n,i){var r=this.__instances[e];return r||(this.trigger("loadInstance",t,e),r=this.__instances[e]),r?(r=r.instance,i=s.map(i,this._unserializeValue,this),r.invoke(n,i,t).mapSuccess(function(t){return this._serializeValue(t)},this)):a.error(e)}}}])}),d.define("module:RMI.Skeleton",["module:Class","module:Objs","module:Promise"],function(t,i,r,e){return t.extend({scoped:e},function(n){return{intf:[],_stub:null,_intf:{},__superIntf:["_destroy"],constructor:function(t){this._options=i.extend({destroyable:!1},t),n.constructor.call(this),this.intf=this.intf.concat(this.__superIntf);for(var e=0;e<this.intf.length;++e)this._intf[this.intf[e]]=!0},_destroy:function(){this._options.destroyable&&this.destroy()},invoke:function(t,e){if(!this._intf[t])return r.error(t);try{var n=this[t].apply(this,e);return r.is(n)?n:r.value(n)}catch(i){return r.error(i)}},_success:function(t){return r.value(t)},_error:function(t){return r.error(t)},stub:function(){if(this._stub)return this._stub;var t=this.cls.classname;return 0<=t.indexOf("Skeleton")?t.replace("Skeleton","Stub"):t}}})}),d.define("module:RMI.Stub",["module:Class","module:Classes.InvokerMixin","module:Functions"],function(t,e,n,i){return t.extend({scoped:i},[e,function(t){return{intf:[],serializes:{},constructor:function(){t.constructor.call(this),this.invoke_delegate("invoke",this.intf)},destroy:function(){this.invoke("_destroy"),t.destroy.call(this)},invoke:function(t){return this.__send(t,n.getArguments(arguments,1),this.serializes[t])}}}])}),d.define("module:RMI.StubSyncer",["module:Class","module:Classes.InvokerMixin","module:Functions","module:Promise"],function(t,e,n,i,r){return t.extend({scoped:r},[e,function(e){return{constructor:function(t){e.constructor.call(this),this.__stub=t,this.__current=null,this.__queue=[],this.invoke_delegate("invoke",this.__stub.intf)},invoke:function(){var t={args:n.getArguments(arguments),promise:i.create()};return this.__queue.push(t),this.__current||this.__next(),t.promise},__next:function(){0!==this.__queue.length&&(this.__current=this.__queue.shift(),this.__stub.invoke.apply(this.__stub,this.__current.args).forwardCallback(this.__current.promise).callback(this.__next,this))}}}])}),d.define("module:Scheduling.GarbageCollector",["module:Class","module:Scheduling.SchedulableMixin"],function(t,e,n){return t.extend({scoped:n},[e,function(t){return{constructor:function(){t.constructor.call(this),this.__classes={}},queue:function(t){if(!t||t.destroyed()||this.__classes[t.cid()])return this;var e=t.cid();return this.__classes[e]=!0,this.schedulable(function(){delete this.__classes[e],t.destroyed()||t.destroy(),delete t.__gc}),this}}}])}),d.define("module:Scheduling.SchedulableMixin",[],function(){return{schedulable:function(t,e){this.scheduler?this.scheduler.schedulable(this,t,e):t.call(this,Infinity)}}}),d.define("module:Scheduling.Helper",[],function(){return{schedulable:function(t,e,n,i){n?n.schedulable(i||this,t,e):t.call(i||this,Infinity)}}}),d.define("module:Scheduling.AbstractScheduler",["module:Class"],function(t,e){return t.extend({scoped:e},function(t){return{_schedulable:function(t,e,n){},_register:function(t,e){},_unregister:function(t,e){},schedulable:function(t,e,n){this._schedulable(t,e,n||1)},register:function(t,e){(t.scheduler=this)._register(t,e)},unregister:function(t,e){t.scheduler===this&&(t.scheduler=null),this._unregister(t,e)}}})}),d.define("module:Scheduling.DefaultScheduler",["module:Scheduling.AbstractScheduler","module:Time","module:Objs","module:Timers.Timer"],function(t,_,n,i,e){return t.extend({scoped:e},function(e){return{constructor:function(t){e.constructor.call(this),this._current=null,this._last=null,this._first=null,this._map={},this._resources=0,this._options=n.extend({penaltyFactor:.5,rewardFactor:.5,defaultResources:10,defaultLimit:10,autoTimer:null},t),this._options.autoTimer&&this.auto_destroy(new i({start:!0,delay:this._options.autoTimer,context:this,fire:this.run}))},_register:function(t,e){var n,i=t.cid();this._map[i]||(n={context:t,resources:(e=e||{}).resources||this._options.defaultResources,scheduled:[],allocatedTime:0,usedTime:0,prev:this._last,next:null},this._map[i]=n,this._last=n,this._first||(this._first=n))},_unregister:function(t){var e,n=context.cid();this._map[n]&&(e=this._map[n],this._current===e&&(this._current=e.next),e.prev?e.prev.next=e.next:this._first=e.next,e.next?e.next.prev=e.prev:this._last=e.prev,e.scheduled&&(this._resources-=e.resources),delete this._map[n])},_schedulable:function(t,e,n){var i=t.cid(),r=this._map[i];r&&(r.scheduled.push({callback:e,initialSteps:n,totalTime:0,totalSteps:0}),1===r.scheduled.length&&(this._resources+=r.resources))},run:function(t){t=t||this._options.defaultLimit;for(var e=_.perfNow()+t;0<this._resources&&this._first;){var n=_.perfNow();if(e-n<=0)break;var i=this._current||this._first;if(0<i.scheduled.length){var r=i.resources;i.allocatedTime>i.usedTime&&(r+=i.usedTime/i.allocatedTime*this._options.rewardFactor),i.allocatedTime<i.usedTime&&(r-=i.allocatedTime/i.usedTime*this._options.penaltyFactor);var s=Math.min(n+t*r/this._resources,e);do{var o=s-n,u=i.scheduled.shift(),a=Math.max(1,0<u.totalSteps?u.totalSteps/(u.totalTime||1)*o:u.initialSteps);!1===u.callback.call(i.context,a)?i.scheduled.unshift(u):0===i.scheduled.length&&(this._resources-=i.resources);var c=_.perfNow();i.allocatedTime+=o,i.usedTime+=c-n,n=c}while(n<s&&0<i.scheduled.length)}this._current=i.next}}}})}),d.define("module:States.CompetingComposite",["module:Class","module:Objs"],function(t,n,e){return t.extend({scoped:e},function(t){return{_register_host:function(t){this._hosts=this._hosts||[],this._hosts.push(this._auto_destroy(t))},other_hosts:function(e){return n.filter(this._hosts||[],function(t){return t!=e},this)},_next:function(t,e){for(var n=this.other_hosts(t),i=0;i<n.length;++i){var r=n[i].state();r.can_coexist_with(e)||r.retreat_against(e)}}}})}),d.define("module:States.CompetingHost",["module:States.Host"],function(t,e){return t.extend({scoped:e},function(r){return{constructor:function(t,e){r.constructor.call(this,e),(this._composite=t)&&t._register_host(this)},composite:function(){return this._composite},_can_transition_to:function(t){if(!r._can_transition_to.call(this,t))return!1;if(!this._composite)return!0;for(var e=this._composite.other_hosts(this),n=0;n<e.length;++n){var i=e[n].state();if(!t.can_coexist_with(i)&&!t.can_prevail_against(i))return!1}return!0},_next:function(t){this._composite&&this._composite._next(this,t),r._next.call(this,t)}}})}),d.define("module:States.CompetingState",["module:States.State"],function(t,e){return t.extend({scoped:e},function(t){return{can_coexist_with:function(t){return!0},can_prevail_against:function(t){return!1},retreat_against:function(t){}}})}),d.define("module:Router.RouteParser",["module:Class","module:Strings","module:Objs"],function(t,i,n,e){return t.extend({scoped:e},function(e){return{constructor:function(t){e.constructor.call(this),this.routes={},n.iter(t,function(t,e){this.bind(e,t)},this)},parse:function(t){for(var e in this.routes){var n=this.routes[e],i=n.captureRegex.exec(t);if(i)return{name:n.name,args:i}}return null},format:function(t,e){e=e||{};var n=this.routes[t];return i.regexReplaceGroups(n.regex,n.captureRegex.mapBack(e))},bind:function(t,e){return this.routes[t]={name:t,regex:e,captureRegex:i.namedCaptureRegex("^"+e+"$")},this}}})}),d.define("module:Router.RouteMap",["module:Class","module:Strings","module:Objs"],function(t,e,n,i){return t.extend({scoped:i},function(e){return{constructor:function(t){e.constructor.call(this),t=t||{},this._defaultMap=t.map,this._context=t.context||this,this._bindings=t.bindings||{}},map:function(t,e){var n=this._bindings[t];return n?n.call(this._context,t,e):this._defaultMap?this._defaultMap.call(this._context,t,e):{name:t,args:e}},bind:function(t,e){return this._bindings[t]=e,this}}})}),d.define("module:Router.Router",["module:Class","module:Events.EventsMixin","module:Objs","module:Router.RouteParser","module:Comparators"],function(t,e,n,i,r,s){return t.extend({scoped:s},[e,function(e){return{constructor:function(t){e.constructor.call(this),this._routeParser=new i(t),this._current=null},destroy:function(){this._routeParser.destroy(),e.destroy.call(this)},bind:function(t,e,n,i){return this._routeParser.bind(t,e),n&&this.on("dispatch:"+t,n,i),this},current:function(){return this._current},navigate:function(t){this.trigger("navigate",t),this.trigger("navigate:"+t);var e=this._routeParser.parse(t);return e?this.dispatch(e.name,e.args,t):this.trigger("notfound",t),this},dispatch:function(t,e,n){if(this._current){if(this._current.name===t&&r.deepEqual(e,this._current.args,2))return;this.trigger("leave",this._current.name,this._current.args,this._current),this.trigger("leave:"+this._current.name,this._current.args,this._current)}var i={route:n||this.format(t,e),name:t,args:e};return this.trigger("dispatch",t,e,i),this.trigger("dispatch:"+t,e,i),this._current=i,this.trigger("dispatched",t,e,i),this.trigger("dispatched:"+t,e,i),this},format:function(t,e){return this._routeParser.format(t,e)}}}])}),d.define("module:Router.RouteBinder",["module:Class","module:Types","module:Comparators"],function(t,n,i,e){return t.extend({scoped:e},function(e){return{_setLocalRoute:function(t){},_getLocalRoute:function(){},_localRouteChanged:function(){this.setGlobalRoute(this._getLocalRoute())},constructor:function(t){e.constructor.call(this),(this._router=t).on("dispatched",function(){this.setLocalRoute(t.current())},this),t.current()?this.setLocalRoute(t.current()):this._getLocalRoute()&&this.setGlobalRoute(this._getLocalRoute())},destroy:function(){this._router.off(null,null,this),e.destroy.call(this)},setLocalRoute:function(t){return this._lastLocalRoute=t,this._setLocalRoute(t),this},setGlobalRoute:function(t){return n.is_string(t)?this._lastLocalRoute&&t===this._lastLocalRoute.route||this._router.navigate(t):this._lastLocalRoute&&t.name===this._lastLocalRoute.name&&i.deepEqual(t.args,this._lastLocalRoute.args,2)||this._router.dispatch(t.name,t.args),this}}})}),d.define("module:Router.StateRouteBinder",["module:Router.RouteBinder","module:Objs","module:Strings","module:Router.RouteMap"],function(t,r,s,o,e){return t.extend({scoped:e},function(i){return{constructor:function(t,e,n){this._stateHost=e,n=r.extend({capitalizeStates:!1},n),this._options=n,this._routeToState=new o({map:this._options.routeToState||function(t,e){return{name:n.capitalizeStates?s.capitalize(t):t,args:e}},context:this._options.context}),this._stateToRoute=new o({map:this._options.stateToRoute||function(t,e){return{name:t.toLowerCase(),args:e}},context:this._options.context}),i.constructor.call(this,t),e.on("start",this._localRouteChanged,this)},destroy:function(){this._routeToState.destroy(),this._stateToRoute.destroy(),this._stateHost.off(null,null,this),i.destroy.call(this)},bindRouteToState:function(t,e){return this._routeToState.bind(t,e),this},bindStateToRoute:function(t,e){return this._stateToRoute.bind(t,e),this},register:function(t,e,n){return this._router.bind(t,e),this._stateHost.register(this._options.capitalizeStates?s.capitalize(t):t,n),this},_setLocalRoute:function(t){var e=this._routeToState.map(t.name,t.args);e&&this._stateHost.weakNext(e.name,e.args)},_getLocalRoute:function(){if(!this._stateHost.state())return null;var t=this._stateHost.state();return this._stateToRoute.map(t.state_name(),t.allAttr())}}})}),d.define("module:Router.RouterHistory",["module:Class","module:Events.EventsMixin"],function(t,e,n){return t.extend({scoped:n},[e,function(e){return{constructor:function(t){e.constructor.call(this),this._router=t,this._history=[],t.on("dispatched",function(t,e,n){this._history.push(n),this.trigger("change",n),this.trigger("insert",n)},this)},destroy:function(){this._router.off(null,null,this),e.destroy.call(this)},last:function(t){return t=t||0,this.get(this.count()-1-t)},count:function(){return this._history.length},pop:function(){return this._history.pop()},get:function(t){return t=t||0,this._history[t]},back:function(t){if(this.count()<2)return null;for(t=t||0;0<=t&&1<this.count();){var e=this.pop();this.trigger("remove",e),--t}var n=this.pop();return this.trigger("change",n),this._router.dispatch(n.name,n.args)}}}])}),d.define("module:States.Host",["module:Properties.Properties","module:Events.EventsMixin","module:States.State","module:Types","module:Strings","module:Classes.ClassRegistry"],function(t,e,s,o,u,a,n){return t.extend({scoped:n},[e,function(e){return{constructor:function(t){e.constructor.call(this),t=t||{},this._stateRegistry=t.stateRegistry,this._baseState=t.baseState,this._enabled=!0},initialize:function(t,e){var n,i;return this._stateRegistry||(i=null,i=o.is_string(t)&&0<=t.indexOf(".")?(t=(n=u.splitLast(t,".")).tail,n.head):o.is_string(t)?u.splitLast(this.cls.classname,".").head:u.splitLast(t.classname,".").head,this._stateRegistry=this._auto_destroy(new a(d.getGlobal(i)))),this._createState(t,e).start(),this._baseState=this._baseState||this._state.cls,this},_createState:function(t,e,n){return this._stateRegistry.create(t,this,e||{},n||{})},finalize:function(){return this._state&&this._state.end(),this._state=null,this},destroy:function(){this.finalize(),e.destroy.call(this)},enable:function(){return this._enabled=!0,this},disable:function(){return this._enabled=!1,this},state:function(){return this._state},state_name:function(){return this.state().state_name()},next:function(){return this.state()?this.state().next.apply(this.state(),arguments):this.initialize.apply(this,arguments)},weakNext:function(){return this.state()?this.state().weakNext.apply(this.state(),arguments):this.initialize.apply(this,arguments)},_start:function(t){this._stateEvent(t,"before_start"),this._state=t,this.set("name",t.state_name())},_afterStart:function(t){this._stateEvent(t,"start")},_end:function(t){this._stateEvent(t,"end"),this._state=null},_afterEnd:function(t){this._stateEvent(t,"after_end")},_next:function(t){this._stateEvent(t,"next")},_afterNext:function(t){this._stateEvent(t,"after_next")},_can_transition_to:function(t){return this._enabled},_stateEvent:function(t,e){this.trigger("event",e,t.state_name(),t.description()),this.trigger(e,t.state_name(),t.description()),this.trigger(e+":"+t.state_name(),t.description())},register:function(t,e,n){o.is_string(e)||(n=e,e=null),this._stateRegistry||(this._stateRegistry=this._auto_destroy(new a(u.splitLast(this.cls.classname).head)));var i=this._baseState?u.splitLast(this._baseState.classname,".").head+"."+t:0<=t.indexOf(".")?t:null,r=(this._stateRegistry.get(e)||this._baseState||s).extend(i,n);return i||(r.classname=t),this._stateRegistry.register(u.last_after(t,"."),r),this}}}])}),d.define("module:States.State",["module:Class","module:Types","module:Strings","module:Async","module:Objs"],function(t,o,e,n,u,i){return t.extend({scoped:i},function(s){return{_locals:[],_persistents:[],_defaults:{},_clonedDefaults:{},_white_list:null,_starting:!1,_started:!1,_stopped:!1,_transitioning:!1,__next_state:null,__suspended:0,constructor:function(n,t,e){s.constructor.call(this),this.host=n,this.transitionals=e,t=u.extend(u.extend(u.clone(this._clonedDefaults||{},-1),u.clone(this._defaults||{},1)),t),this._locals=o.is_function(this._locals)?this._locals():this._locals;for(var i={},r=0;r<this._locals.length;++r)this["_"+this._locals[r]]=t[this._locals[r]],i[this._locals[r]]=!0;for(this._persistents=o.is_function(this._persistents)?this._persistents():this._persistents,r=0;r<this._persistents.length;++r)this["_"+this._persistents[r]]=t[this._persistents[r]],i[this._locals[r]]=!0;n.suspendEvents(),this.__hostArgs={},u.iter(t,function(t,e){i[e]||(this.__hostArgs[e]=!0,n.set(e,t))},this),n.resumeEvents()},allAttr:function(){var e=u.clone(this.host.data(),1);return u.iter(this._locals,function(t){e[t]=this["_"+t]},this),u.iter(this._persistents,function(t){e[t]=this["_"+t]},this),e},state_name:function(){return e.last_after(this.cls.classname,".")},description:function(){return this.state_name()},start:function(){return this._starting||(this._starting=!0,this.host._start(this),this._start(),this.host&&(this.host._afterStart(this),this._started=!0)),this},end:function(){return this._stopped||(this._stopped=!0,this._end(),this.host._end(this),this.host._afterEnd(this),this.destroy()),this},eventualNext:function(t,e,n){this.suspend();var i=this.next(t,e,n);return this.eventualResume(),i},next:function(t,e,n){if(!this._starting||this._stopped||this.__next_state)return null;e=e||{};for(var i=0;i<this._persistents.length;++i)this._persistents[i]in e||(e[this._persistents[i]]=this["_"+this._persistents[i]]);var r=this.host._createState(t,e,n);return this.can_transition_to(r)?(this._started||(this.host._afterStart(this),this._started=!0),this.__next_state=r,this._transitioning=!0,this._transition(),this.__suspended<=0&&this.__next(),r):(r.destroy(),null)},weakSame:function(t,e,n){var i=!0;t!==this.state_name()&&(i=!1);var r=this.allAttr();return u.iter(e,function(t,e){r[e]!==t&&(i=!1)},this),i},weakNext:function(t,e,n){return this.weakSame.apply(this,arguments)?this:this.next.apply(this,arguments)},__next:function(){var n=this.host,i=this.__next_state;n._next(i);var t=this.__hostArgs;this.end(),i.start(),n.suspendEvents(),(i=n.state())&&!i.destroyed()&&(u.iter(t,function(t,e){i.__hostArgs[e]||n.unset(e)},this),n.resumeEvents(),n._afterNext(i))},_transition:function(){},suspend:function(){return this.__suspended++,this},eventualResume:function(){return n.eventually(this.resume,this),this},resume:function(){return this.__suspended--,0===this.__suspended&&!this._stopped&&this.__next_state&&this.__next(),this},can_transition_to:function(t){return this.host&&this.host._can_transition_to(t)&&this._can_transition_to(t)},_start:function(){},_end:function(){},_can_transition_to:function(t){return!o.is_array(this._white_list)||u.contains_value(this._white_list,t.state_name())}}},{_extender:{_defaults:function(t,e){return u.extend(u.clone(t,1),e)}}})}),d.define("module:States.StateRouter",["module:Class","module:Objs"],function(t,r,e){return t.extend({scoped:e},function(e){return{constructor:function(t){e.constructor.call(this),this._host=t,this._routes=[],this._states={}},registerRoute:function(t,e,n){var i={key:t,route:new RegExp("^"+t+"$"),state:e,mapping:n||[]};return this._routes.push(i),this._states[e]=i,this},readRoute:function(e){var t=this._states[e.state_name()];if(!t)return null;var n=/\(.*?\)/,i=t.key;return r.iter(t.mapping,function(t){i=i.replace(n,e["_"+t])},this),i},parseRoute:function(t){for(var e=0;e<this._routes.length;++e){var n=this._routes[e],i=n.route.exec(t);if(null!==i){for(var r={},s=0;s<n.mapping.length;++s)r[n.mapping[s]]=i[s+1];return{state:n.state,args:r}}}return null},currentRoute:function(){return this.readRoute(this._host.state())},navigateRoute:function(t){var e=this.parseRoute(t);return e&&this._host.next(e.state,e.args),this}}})})}).call(Scoped);